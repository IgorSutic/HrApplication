{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/compactAppointmentsHelper.js)\r\n * Version: 21.1.6\r\n * Build date: Mon Sep 27 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport Button from \"../button\";\nimport { move, locate } from \"../../animation/translator\";\nimport messageLocalization from \"../../localization/message\";\nimport { FunctionTemplate } from \"../../core/templates/function_template\";\nimport { when } from \"../../core/utils/deferred\";\nimport { extendFromObject } from \"../../core/utils/extend\";\nimport { getBoundingRect } from \"../../core/utils/position\";\nimport { AppointmentTooltipInfo } from \"./dataStructures\";\nimport { LIST_ITEM_DATA_KEY, LIST_ITEM_CLASS } from \"./constants\";\nvar APPOINTMENT_COLLECTOR_CLASS = \"dx-scheduler-appointment-collector\";\nvar COMPACT_APPOINTMENT_COLLECTOR_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-compact\";\nvar APPOINTMENT_COLLECTOR_CONTENT_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-content\";\nvar WEEK_VIEW_COLLECTOR_OFFSET = 5;\nvar COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET = 1;\nexport class CompactAppointmentsHelper {\n  constructor(instance) {\n    this.instance = instance;\n    this.elements = [];\n  }\n\n  render(options) {\n    var {\n      isCompact: isCompact,\n      items: items,\n      buttonColor: buttonColor\n    } = options;\n\n    var template = this._createTemplate(items.data.length, isCompact);\n\n    var button = this._createCompactButton(template, options);\n\n    var $button = button.$element();\n\n    this._makeBackgroundColor($button, items.colors, buttonColor);\n\n    this._makeBackgroundDarker($button);\n\n    this.elements.push($button);\n    $button.data(\"items\", this._createTooltipInfos(items));\n    return $button;\n  }\n\n  clear() {\n    this.elements.forEach(button => {\n      button.detach();\n      button.remove();\n    });\n    this.elements = [];\n  }\n\n  _createTooltipInfos(items) {\n    return items.data.map((appointment, index) => {\n      var _items$settings;\n\n      var targetedAdapter = this.instance.createAppointmentAdapter(appointment).clone();\n\n      if ((null === (_items$settings = items.settings) || void 0 === _items$settings ? void 0 : _items$settings.length) > 0) {\n        var {\n          info: info\n        } = items.settings[index];\n        targetedAdapter.startDate = info.sourceAppointment.startDate;\n        targetedAdapter.endDate = info.sourceAppointment.endDate;\n      }\n\n      return new AppointmentTooltipInfo(appointment, targetedAdapter.source(), items.colors[index], items.settings[index]);\n    });\n  }\n\n  _onButtonClick(e, options) {\n    var $button = $(e.element);\n    this.instance.showAppointmentTooltipCore($button, $button.data(\"items\"), this._getExtraOptionsForTooltip(options, $button));\n  }\n\n  _getExtraOptionsForTooltip(options, $appointmentCollector) {\n    return {\n      clickEvent: this._clickEvent(options.onAppointmentClick).bind(this),\n      dragBehavior: options.allowDrag && this._createTooltipDragBehavior($appointmentCollector).bind(this),\n      dropDownAppointmentTemplate: this.instance.option().dropDownAppointmentTemplate,\n      isButtonClick: true\n    };\n  }\n\n  _clickEvent(onAppointmentClick) {\n    return e => {\n      var config = {\n        itemData: e.itemData.appointment,\n        itemElement: e.itemElement,\n        targetedAppointment: e.itemData.targetedAppointment\n      };\n      var createClickEvent = extendFromObject(this.instance.fire(\"mapAppointmentFields\", config), e, false);\n      delete createClickEvent.itemData;\n      delete createClickEvent.itemIndex;\n      delete createClickEvent.itemElement;\n      onAppointmentClick(createClickEvent);\n    };\n  }\n\n  _createTooltipDragBehavior($appointmentCollector) {\n    return e => {\n      var $element = $(e.element);\n      var workSpace = this.instance.getWorkSpace();\n      var initialPosition = locate($appointmentCollector);\n      var options = {\n        filter: \".\".concat(LIST_ITEM_CLASS),\n        isSetCursorOffset: true,\n        initialPosition: initialPosition,\n        getItemData: itemElement => {\n          var _$$data;\n\n          return null === (_$$data = $(itemElement).data(LIST_ITEM_DATA_KEY)) || void 0 === _$$data ? void 0 : _$$data.appointment;\n        },\n        getItemSettings: (_, event) => event.itemSettings\n      };\n\n      workSpace._createDragBehaviorBase($element, options);\n    };\n  }\n\n  _getCollectorOffset(width, cellWidth) {\n    return cellWidth - width - this._getCollectorRightOffset();\n  }\n\n  _getCollectorRightOffset() {\n    return this.instance.getRenderingStrategyInstance()._isCompactTheme() ? COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET : WEEK_VIEW_COLLECTOR_OFFSET;\n  }\n\n  _makeBackgroundDarker(button) {\n    button.css(\"boxShadow\", \"inset \".concat(getBoundingRect(button.get(0)).width, \"px 0 0 0 rgba(0, 0, 0, 0.3)\"));\n  }\n\n  _makeBackgroundColor($button, colors, color) {\n    when.apply(null, colors).done(function () {\n      this._makeBackgroundColorCore($button, color, arguments);\n    }.bind(this));\n  }\n\n  _makeBackgroundColorCore($button, color, itemsColors) {\n    var paintButton = true;\n    var currentItemColor;\n    color && color.done(function (color) {\n      if (itemsColors.length) {\n        currentItemColor = itemsColors[0];\n\n        for (var i = 1; i < itemsColors.length; i++) {\n          if (currentItemColor !== itemsColors[i]) {\n            paintButton = false;\n            break;\n          }\n\n          currentItemColor = color;\n        }\n      }\n\n      color && paintButton && $button.css(\"backgroundColor\", color);\n    }.bind(this));\n  }\n\n  _setPosition(element, position) {\n    move(element, {\n      top: position.top,\n      left: position.left\n    });\n  }\n\n  _createCompactButton(template, options) {\n    var $button = this._createCompactButtonElement(options);\n\n    return this.instance._createComponent($button, Button, {\n      type: \"default\",\n      width: options.width,\n      height: options.height,\n      onClick: e => this._onButtonClick(e, options),\n      template: this._renderTemplate(template, options.items, options.isCompact)\n    });\n  }\n\n  _createCompactButtonElement(_ref) {\n    var {\n      isCompact: isCompact,\n      $container: $container,\n      width: width,\n      coordinates: coordinates,\n      applyOffset: applyOffset,\n      cellWidth: cellWidth\n    } = _ref;\n    var result = $(\"<div>\").addClass(APPOINTMENT_COLLECTOR_CLASS).toggleClass(COMPACT_APPOINTMENT_COLLECTOR_CLASS, isCompact).appendTo($container);\n    var offset = applyOffset ? this._getCollectorOffset(width, cellWidth) : 0;\n\n    this._setPosition(result, {\n      top: coordinates.top,\n      left: coordinates.left + offset\n    });\n\n    return result;\n  }\n\n  _renderTemplate(template, items, isCompact) {\n    return new FunctionTemplate(options => template.render({\n      model: {\n        appointmentCount: items.data.length,\n        isCompact: isCompact\n      },\n      container: options.container\n    }));\n  }\n\n  _createTemplate(count, isCompact) {\n    this._initButtonTemplate(count, isCompact);\n\n    return this.instance._getAppointmentTemplate(\"appointmentCollectorTemplate\");\n  }\n\n  _initButtonTemplate(count, isCompact) {\n    this.instance._templateManager.addDefaultTemplates({\n      appointmentCollector: new FunctionTemplate(options => this._createButtonTemplate(count, $(options.container), isCompact))\n    });\n  }\n\n  _createButtonTemplate(appointmentCount, element, isCompact) {\n    var text = isCompact ? appointmentCount : messageLocalization.getFormatter(\"dxScheduler-moreAppointments\")(appointmentCount);\n    return element.append($(\"<span>\").text(text)).addClass(APPOINTMENT_COLLECTOR_CONTENT_CLASS);\n  }\n\n}","map":{"version":3,"sources":["/home/igor/node_modules/devextreme/esm/ui/scheduler/compactAppointmentsHelper.js"],"names":["$","Button","move","locate","messageLocalization","FunctionTemplate","when","extendFromObject","getBoundingRect","AppointmentTooltipInfo","LIST_ITEM_DATA_KEY","LIST_ITEM_CLASS","APPOINTMENT_COLLECTOR_CLASS","COMPACT_APPOINTMENT_COLLECTOR_CLASS","APPOINTMENT_COLLECTOR_CONTENT_CLASS","WEEK_VIEW_COLLECTOR_OFFSET","COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET","CompactAppointmentsHelper","constructor","instance","elements","render","options","isCompact","items","buttonColor","template","_createTemplate","data","length","button","_createCompactButton","$button","$element","_makeBackgroundColor","colors","_makeBackgroundDarker","push","_createTooltipInfos","clear","forEach","detach","remove","map","appointment","index","_items$settings","targetedAdapter","createAppointmentAdapter","clone","settings","info","startDate","sourceAppointment","endDate","source","_onButtonClick","e","element","showAppointmentTooltipCore","_getExtraOptionsForTooltip","$appointmentCollector","clickEvent","_clickEvent","onAppointmentClick","bind","dragBehavior","allowDrag","_createTooltipDragBehavior","dropDownAppointmentTemplate","option","isButtonClick","config","itemData","itemElement","targetedAppointment","createClickEvent","fire","itemIndex","workSpace","getWorkSpace","initialPosition","filter","concat","isSetCursorOffset","getItemData","_$$data","getItemSettings","_","event","itemSettings","_createDragBehaviorBase","_getCollectorOffset","width","cellWidth","_getCollectorRightOffset","getRenderingStrategyInstance","_isCompactTheme","css","get","color","apply","done","_makeBackgroundColorCore","arguments","itemsColors","paintButton","currentItemColor","i","_setPosition","position","top","left","_createCompactButtonElement","_createComponent","type","height","onClick","_renderTemplate","_ref","$container","coordinates","applyOffset","result","addClass","toggleClass","appendTo","offset","model","appointmentCount","container","count","_initButtonTemplate","_getAppointmentTemplate","_templateManager","addDefaultTemplates","appointmentCollector","_createButtonTemplate","text","getFormatter","append"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/compactAppointmentsHelper.js)\r\n * Version: 21.1.6\r\n * Build date: Mon Sep 27 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport Button from \"../button\";\r\nimport {\r\n    move,\r\n    locate\r\n} from \"../../animation/translator\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    FunctionTemplate\r\n} from \"../../core/templates/function_template\";\r\nimport {\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    extendFromObject\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    getBoundingRect\r\n} from \"../../core/utils/position\";\r\nimport {\r\n    AppointmentTooltipInfo\r\n} from \"./dataStructures\";\r\nimport {\r\n    LIST_ITEM_DATA_KEY,\r\n    LIST_ITEM_CLASS\r\n} from \"./constants\";\r\nvar APPOINTMENT_COLLECTOR_CLASS = \"dx-scheduler-appointment-collector\";\r\nvar COMPACT_APPOINTMENT_COLLECTOR_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-compact\";\r\nvar APPOINTMENT_COLLECTOR_CONTENT_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-content\";\r\nvar WEEK_VIEW_COLLECTOR_OFFSET = 5;\r\nvar COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET = 1;\r\nexport class CompactAppointmentsHelper {\r\n    constructor(instance) {\r\n        this.instance = instance;\r\n        this.elements = []\r\n    }\r\n    render(options) {\r\n        var {\r\n            isCompact: isCompact,\r\n            items: items,\r\n            buttonColor: buttonColor\r\n        } = options;\r\n        var template = this._createTemplate(items.data.length, isCompact);\r\n        var button = this._createCompactButton(template, options);\r\n        var $button = button.$element();\r\n        this._makeBackgroundColor($button, items.colors, buttonColor);\r\n        this._makeBackgroundDarker($button);\r\n        this.elements.push($button);\r\n        $button.data(\"items\", this._createTooltipInfos(items));\r\n        return $button\r\n    }\r\n    clear() {\r\n        this.elements.forEach(button => {\r\n            button.detach();\r\n            button.remove()\r\n        });\r\n        this.elements = []\r\n    }\r\n    _createTooltipInfos(items) {\r\n        return items.data.map((appointment, index) => {\r\n            var _items$settings;\r\n            var targetedAdapter = this.instance.createAppointmentAdapter(appointment).clone();\r\n            if ((null === (_items$settings = items.settings) || void 0 === _items$settings ? void 0 : _items$settings.length) > 0) {\r\n                var {\r\n                    info: info\r\n                } = items.settings[index];\r\n                targetedAdapter.startDate = info.sourceAppointment.startDate;\r\n                targetedAdapter.endDate = info.sourceAppointment.endDate\r\n            }\r\n            return new AppointmentTooltipInfo(appointment, targetedAdapter.source(), items.colors[index], items.settings[index])\r\n        })\r\n    }\r\n    _onButtonClick(e, options) {\r\n        var $button = $(e.element);\r\n        this.instance.showAppointmentTooltipCore($button, $button.data(\"items\"), this._getExtraOptionsForTooltip(options, $button))\r\n    }\r\n    _getExtraOptionsForTooltip(options, $appointmentCollector) {\r\n        return {\r\n            clickEvent: this._clickEvent(options.onAppointmentClick).bind(this),\r\n            dragBehavior: options.allowDrag && this._createTooltipDragBehavior($appointmentCollector).bind(this),\r\n            dropDownAppointmentTemplate: this.instance.option().dropDownAppointmentTemplate,\r\n            isButtonClick: true\r\n        }\r\n    }\r\n    _clickEvent(onAppointmentClick) {\r\n        return e => {\r\n            var config = {\r\n                itemData: e.itemData.appointment,\r\n                itemElement: e.itemElement,\r\n                targetedAppointment: e.itemData.targetedAppointment\r\n            };\r\n            var createClickEvent = extendFromObject(this.instance.fire(\"mapAppointmentFields\", config), e, false);\r\n            delete createClickEvent.itemData;\r\n            delete createClickEvent.itemIndex;\r\n            delete createClickEvent.itemElement;\r\n            onAppointmentClick(createClickEvent)\r\n        }\r\n    }\r\n    _createTooltipDragBehavior($appointmentCollector) {\r\n        return e => {\r\n            var $element = $(e.element);\r\n            var workSpace = this.instance.getWorkSpace();\r\n            var initialPosition = locate($appointmentCollector);\r\n            var options = {\r\n                filter: \".\".concat(LIST_ITEM_CLASS),\r\n                isSetCursorOffset: true,\r\n                initialPosition: initialPosition,\r\n                getItemData: itemElement => {\r\n                    var _$$data;\r\n                    return null === (_$$data = $(itemElement).data(LIST_ITEM_DATA_KEY)) || void 0 === _$$data ? void 0 : _$$data.appointment\r\n                },\r\n                getItemSettings: (_, event) => event.itemSettings\r\n            };\r\n            workSpace._createDragBehaviorBase($element, options)\r\n        }\r\n    }\r\n    _getCollectorOffset(width, cellWidth) {\r\n        return cellWidth - width - this._getCollectorRightOffset()\r\n    }\r\n    _getCollectorRightOffset() {\r\n        return this.instance.getRenderingStrategyInstance()._isCompactTheme() ? COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET : WEEK_VIEW_COLLECTOR_OFFSET\r\n    }\r\n    _makeBackgroundDarker(button) {\r\n        button.css(\"boxShadow\", \"inset \".concat(getBoundingRect(button.get(0)).width, \"px 0 0 0 rgba(0, 0, 0, 0.3)\"))\r\n    }\r\n    _makeBackgroundColor($button, colors, color) {\r\n        when.apply(null, colors).done(function() {\r\n            this._makeBackgroundColorCore($button, color, arguments)\r\n        }.bind(this))\r\n    }\r\n    _makeBackgroundColorCore($button, color, itemsColors) {\r\n        var paintButton = true;\r\n        var currentItemColor;\r\n        color && color.done(function(color) {\r\n            if (itemsColors.length) {\r\n                currentItemColor = itemsColors[0];\r\n                for (var i = 1; i < itemsColors.length; i++) {\r\n                    if (currentItemColor !== itemsColors[i]) {\r\n                        paintButton = false;\r\n                        break\r\n                    }\r\n                    currentItemColor = color\r\n                }\r\n            }\r\n            color && paintButton && $button.css(\"backgroundColor\", color)\r\n        }.bind(this))\r\n    }\r\n    _setPosition(element, position) {\r\n        move(element, {\r\n            top: position.top,\r\n            left: position.left\r\n        })\r\n    }\r\n    _createCompactButton(template, options) {\r\n        var $button = this._createCompactButtonElement(options);\r\n        return this.instance._createComponent($button, Button, {\r\n            type: \"default\",\r\n            width: options.width,\r\n            height: options.height,\r\n            onClick: e => this._onButtonClick(e, options),\r\n            template: this._renderTemplate(template, options.items, options.isCompact)\r\n        })\r\n    }\r\n    _createCompactButtonElement(_ref) {\r\n        var {\r\n            isCompact: isCompact,\r\n            $container: $container,\r\n            width: width,\r\n            coordinates: coordinates,\r\n            applyOffset: applyOffset,\r\n            cellWidth: cellWidth\r\n        } = _ref;\r\n        var result = $(\"<div>\").addClass(APPOINTMENT_COLLECTOR_CLASS).toggleClass(COMPACT_APPOINTMENT_COLLECTOR_CLASS, isCompact).appendTo($container);\r\n        var offset = applyOffset ? this._getCollectorOffset(width, cellWidth) : 0;\r\n        this._setPosition(result, {\r\n            top: coordinates.top,\r\n            left: coordinates.left + offset\r\n        });\r\n        return result\r\n    }\r\n    _renderTemplate(template, items, isCompact) {\r\n        return new FunctionTemplate(options => template.render({\r\n            model: {\r\n                appointmentCount: items.data.length,\r\n                isCompact: isCompact\r\n            },\r\n            container: options.container\r\n        }))\r\n    }\r\n    _createTemplate(count, isCompact) {\r\n        this._initButtonTemplate(count, isCompact);\r\n        return this.instance._getAppointmentTemplate(\"appointmentCollectorTemplate\")\r\n    }\r\n    _initButtonTemplate(count, isCompact) {\r\n        this.instance._templateManager.addDefaultTemplates({\r\n            appointmentCollector: new FunctionTemplate(options => this._createButtonTemplate(count, $(options.container), isCompact))\r\n        })\r\n    }\r\n    _createButtonTemplate(appointmentCount, element, isCompact) {\r\n        var text = isCompact ? appointmentCount : messageLocalization.getFormatter(\"dxScheduler-moreAppointments\")(appointmentCount);\r\n        return element.append($(\"<span>\").text(text)).addClass(APPOINTMENT_COLLECTOR_CONTENT_CLASS)\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}