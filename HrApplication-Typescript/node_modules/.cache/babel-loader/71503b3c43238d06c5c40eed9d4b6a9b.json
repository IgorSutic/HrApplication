{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/resources/agendaResourceProcessor.js)\r\n * Version: 21.1.6\r\n * Build date: Mon Sep 27 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { wrapToArray } from \"../../../core/utils/array\";\nimport { when, Deferred } from \"../../../core/utils/deferred\";\nimport { getFieldExpr, getDisplayExpr, getValueExpr, getWrappedDataSource } from \"./utils\";\n\nclass PromiseItem {\n  constructor(rawAppointment, promise) {\n    this.rawAppointment = rawAppointment;\n    this.promise = promise;\n  }\n\n}\n\nexport class AgendaResourceProcessor {\n  get resourceDeclarations() {\n    return this._resourceDeclarations;\n  }\n\n  set resourceDeclarations(value) {\n    this._resourceDeclarations = value;\n    this.isLoaded = false;\n    this.isLoading = false;\n    this.resourceMap.clear();\n    this.appointmentPromiseQueue = [];\n  }\n\n  constructor() {\n    this._resourceDeclarations = [];\n    this.isLoaded = false;\n    this.isLoading = false;\n    this.resourceMap = new Map();\n    this.appointmentPromiseQueue = [];\n  }\n\n  _pushAllResources() {\n    this.appointmentPromiseQueue.forEach(_ref => {\n      var {\n        promise: promise,\n        rawAppointment: rawAppointment\n      } = _ref;\n      var result = [];\n      this.resourceMap.forEach((resource, fieldName) => {\n        var item = {\n          label: resource.label,\n          values: []\n        };\n\n        if (fieldName in rawAppointment) {\n          wrapToArray(rawAppointment[fieldName]).forEach(value => item.values.push(resource.map.get(value)));\n        }\n\n        if (item.values.length) {\n          result.push(item);\n        }\n      });\n      promise.resolve(result);\n    });\n    this.appointmentPromiseQueue = [];\n  }\n\n  _onPullResource(fieldName, valueName, displayName, label, items) {\n    var map = new Map();\n    items.forEach(item => map.set(item[valueName], item[displayName]));\n    this.resourceMap.set(fieldName, {\n      label: label,\n      map: map\n    });\n  }\n\n  _hasResourceDeclarations(resources) {\n    if (0 === resources.length) {\n      this.appointmentPromiseQueue.forEach(_ref2 => {\n        var {\n          promise: promise\n        } = _ref2;\n        return promise.resolve([]);\n      });\n      this.appointmentPromiseQueue = [];\n      return false;\n    }\n\n    return true;\n  }\n\n  _tryPullResources(resources, resultAsync) {\n    if (!this.isLoading) {\n      this.isLoading = true;\n      var promises = [];\n      resources.forEach(resource => {\n        var promise = new Deferred().done(items => this._onPullResource(getFieldExpr(resource), getValueExpr(resource), getDisplayExpr(resource), resource.label, items));\n        promises.push(promise);\n        var dataSource = getWrappedDataSource(resource.dataSource);\n\n        if (dataSource.isLoaded()) {\n          promise.resolve(dataSource.items());\n        } else {\n          dataSource.load().done(list => promise.resolve(list)).fail(() => promise.reject());\n        }\n      });\n      when.apply(null, promises).done(() => {\n        this.isLoaded = true;\n        this.isLoading = false;\n\n        this._pushAllResources();\n      }).fail(() => resultAsync.reject());\n    }\n  }\n\n  initializeState() {\n    var resourceDeclarations = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\n    this.resourceDeclarations = resourceDeclarations;\n  }\n\n  createListAsync(rawAppointment) {\n    var resultAsync = new Deferred();\n    this.appointmentPromiseQueue.push(new PromiseItem(rawAppointment, resultAsync));\n\n    if (this._hasResourceDeclarations(this.resourceDeclarations)) {\n      if (this.isLoaded) {\n        this._pushAllResources();\n      } else {\n        this._tryPullResources(this.resourceDeclarations, resultAsync);\n      }\n    }\n\n    return resultAsync.promise();\n  }\n\n}","map":{"version":3,"sources":["/home/igor/node_modules/devextreme/esm/ui/scheduler/resources/agendaResourceProcessor.js"],"names":["wrapToArray","when","Deferred","getFieldExpr","getDisplayExpr","getValueExpr","getWrappedDataSource","PromiseItem","constructor","rawAppointment","promise","AgendaResourceProcessor","resourceDeclarations","_resourceDeclarations","value","isLoaded","isLoading","resourceMap","clear","appointmentPromiseQueue","Map","_pushAllResources","forEach","_ref","result","resource","fieldName","item","label","values","push","map","get","length","resolve","_onPullResource","valueName","displayName","items","set","_hasResourceDeclarations","resources","_ref2","_tryPullResources","resultAsync","promises","done","dataSource","load","list","fail","reject","apply","initializeState","arguments","createListAsync"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/resources/agendaResourceProcessor.js)\r\n * Version: 21.1.6\r\n * Build date: Mon Sep 27 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    wrapToArray\r\n} from \"../../../core/utils/array\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../../../core/utils/deferred\";\r\nimport {\r\n    getFieldExpr,\r\n    getDisplayExpr,\r\n    getValueExpr,\r\n    getWrappedDataSource\r\n} from \"./utils\";\r\nclass PromiseItem {\r\n    constructor(rawAppointment, promise) {\r\n        this.rawAppointment = rawAppointment;\r\n        this.promise = promise\r\n    }\r\n}\r\nexport class AgendaResourceProcessor {\r\n    get resourceDeclarations() {\r\n        return this._resourceDeclarations\r\n    }\r\n    set resourceDeclarations(value) {\r\n        this._resourceDeclarations = value;\r\n        this.isLoaded = false;\r\n        this.isLoading = false;\r\n        this.resourceMap.clear();\r\n        this.appointmentPromiseQueue = []\r\n    }\r\n    constructor() {\r\n        this._resourceDeclarations = [];\r\n        this.isLoaded = false;\r\n        this.isLoading = false;\r\n        this.resourceMap = new Map;\r\n        this.appointmentPromiseQueue = []\r\n    }\r\n    _pushAllResources() {\r\n        this.appointmentPromiseQueue.forEach(_ref => {\r\n            var {\r\n                promise: promise,\r\n                rawAppointment: rawAppointment\r\n            } = _ref;\r\n            var result = [];\r\n            this.resourceMap.forEach((resource, fieldName) => {\r\n                var item = {\r\n                    label: resource.label,\r\n                    values: []\r\n                };\r\n                if (fieldName in rawAppointment) {\r\n                    wrapToArray(rawAppointment[fieldName]).forEach(value => item.values.push(resource.map.get(value)))\r\n                }\r\n                if (item.values.length) {\r\n                    result.push(item)\r\n                }\r\n            });\r\n            promise.resolve(result)\r\n        });\r\n        this.appointmentPromiseQueue = []\r\n    }\r\n    _onPullResource(fieldName, valueName, displayName, label, items) {\r\n        var map = new Map;\r\n        items.forEach(item => map.set(item[valueName], item[displayName]));\r\n        this.resourceMap.set(fieldName, {\r\n            label: label,\r\n            map: map\r\n        })\r\n    }\r\n    _hasResourceDeclarations(resources) {\r\n        if (0 === resources.length) {\r\n            this.appointmentPromiseQueue.forEach(_ref2 => {\r\n                var {\r\n                    promise: promise\r\n                } = _ref2;\r\n                return promise.resolve([])\r\n            });\r\n            this.appointmentPromiseQueue = [];\r\n            return false\r\n        }\r\n        return true\r\n    }\r\n    _tryPullResources(resources, resultAsync) {\r\n        if (!this.isLoading) {\r\n            this.isLoading = true;\r\n            var promises = [];\r\n            resources.forEach(resource => {\r\n                var promise = (new Deferred).done(items => this._onPullResource(getFieldExpr(resource), getValueExpr(resource), getDisplayExpr(resource), resource.label, items));\r\n                promises.push(promise);\r\n                var dataSource = getWrappedDataSource(resource.dataSource);\r\n                if (dataSource.isLoaded()) {\r\n                    promise.resolve(dataSource.items())\r\n                } else {\r\n                    dataSource.load().done(list => promise.resolve(list)).fail(() => promise.reject())\r\n                }\r\n            });\r\n            when.apply(null, promises).done(() => {\r\n                this.isLoaded = true;\r\n                this.isLoading = false;\r\n                this._pushAllResources()\r\n            }).fail(() => resultAsync.reject())\r\n        }\r\n    }\r\n    initializeState() {\r\n        var resourceDeclarations = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\r\n        this.resourceDeclarations = resourceDeclarations\r\n    }\r\n    createListAsync(rawAppointment) {\r\n        var resultAsync = new Deferred;\r\n        this.appointmentPromiseQueue.push(new PromiseItem(rawAppointment, resultAsync));\r\n        if (this._hasResourceDeclarations(this.resourceDeclarations)) {\r\n            if (this.isLoaded) {\r\n                this._pushAllResources()\r\n            } else {\r\n                this._tryPullResources(this.resourceDeclarations, resultAsync)\r\n            }\r\n        }\r\n        return resultAsync.promise()\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}