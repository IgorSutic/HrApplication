{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/appointments/appointmentCollection.js)\r\n * Version: 21.1.6\r\n * Build date: Mon Sep 27 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../../core/renderer\";\nimport domAdapter from \"../../../core/dom_adapter\";\nimport eventsEngine from \"../../../events/core/events_engine\";\nimport { data as elementData } from \"../../../core/element_data\";\nimport { locate, move } from \"../../../animation/translator\";\nimport dateUtils from \"../../../core/utils/date\";\nimport { normalizeKey } from \"../../../core/utils/common\";\nimport { isDefined, isDeferred, isString, isPlainObject } from \"../../../core/utils/type\";\nimport { each } from \"../../../core/utils/iterator\";\nimport { deepExtendArraySafe } from \"../../../core/utils/object\";\nimport { merge } from \"../../../core/utils/array\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { getPublicElement } from \"../../../core/element\";\nimport { getRecurrenceProcessor } from \"../recurrence\";\nimport registerComponent from \"../../../core/component_registrator\";\nimport { Appointment, AgendaAppointment } from \"./appointment\";\nimport { addNamespace, isFakeClickEvent } from \"../../../events/utils/index\";\nimport { name as dblclickEvent } from \"../../../events/double_click\";\nimport CollectionWidget from \"../../collection/ui.collection_widget.edit\";\nimport timeZoneUtils from \"../utils.timeZone.js\";\nimport { APPOINTMENT_ITEM_CLASS, APPOINTMENT_DRAG_SOURCE_CLASS, APPOINTMENT_SETTINGS_KEY } from \"../constants\";\nimport { createAgendaAppointmentLayout, createAppointmentLayout } from \"./appointmentLayout\";\nvar COMPONENT_CLASS = \"dx-scheduler-scrollable-appointments\";\nvar DBLCLICK_EVENT_NAME = addNamespace(dblclickEvent, \"dxSchedulerAppointment\");\nvar toMs = dateUtils.dateToMilliseconds;\n\nclass SchedulerAppointments extends CollectionWidget {\n  get isAgendaView() {\n    return this.invoke(\"isCurrentViewAgenda\");\n  }\n\n  get isVirtualScrolling() {\n    return this.invoke(\"isVirtualScrolling\");\n  }\n\n  get resourceManager() {\n    return this.option(\"observer\")._resourcesManager;\n  }\n\n  constructor(element, options) {\n    super(element, options);\n    this._virtualAppointments = {};\n  }\n\n  notifyObserver(subject, args) {\n    var observer = this.option(\"observer\");\n\n    if (observer) {\n      observer.fire(subject, args);\n    }\n  }\n\n  invoke() {\n    var observer = this.option(\"observer\");\n\n    if (observer) {\n      return observer.fire.apply(observer, arguments);\n    }\n  }\n\n  _supportedKeys() {\n    var parent = super._supportedKeys();\n\n    return extend(parent, {\n      escape: function () {\n        this.moveAppointmentBack();\n        this._escPressed = true;\n      }.bind(this),\n      del: function (e) {\n        if (this.option(\"allowDelete\")) {\n          e.preventDefault();\n\n          var data = this._getItemData(e.target);\n\n          this.notifyObserver(\"onDeleteButtonPress\", {\n            data: data,\n            target: e.target\n          });\n        }\n      }.bind(this),\n      tab: function (e) {\n        var appointments = this._getAccessAppointments();\n\n        var focusedAppointment = appointments.filter(\".dx-state-focused\");\n        var index = focusedAppointment.data(APPOINTMENT_SETTINGS_KEY).sortedIndex;\n        var lastIndex = appointments.length - 1;\n\n        if (index > 0 && e.shiftKey || index < lastIndex && !e.shiftKey) {\n          e.preventDefault();\n          e.shiftKey ? index-- : index++;\n\n          var $nextAppointment = this._getAppointmentByIndex(index);\n\n          this._resetTabIndex($nextAppointment);\n\n          eventsEngine.trigger($nextAppointment, \"focus\");\n        }\n      }\n    });\n  }\n\n  _getAppointmentByIndex(sortedIndex) {\n    var appointments = this._getAccessAppointments();\n\n    return appointments.filter(function (_, $item) {\n      return elementData($item, APPOINTMENT_SETTINGS_KEY).sortedIndex === sortedIndex;\n    }).eq(0);\n  }\n\n  _getAccessAppointments() {\n    return this._itemElements().filter(\":visible\").not(\".dx-state-disabled\");\n  }\n\n  _resetTabIndex($appointment) {\n    this._focusTarget().attr(\"tabIndex\", -1);\n\n    $appointment.attr(\"tabIndex\", this.option(\"tabIndex\"));\n  }\n\n  _moveFocus() {}\n\n  _focusTarget() {\n    return this._itemElements();\n  }\n\n  _renderFocusTarget() {\n    var $appointment = this._getAppointmentByIndex(0);\n\n    this._resetTabIndex($appointment);\n  }\n\n  _focusInHandler(e) {\n    super._focusInHandler(e);\n\n    this._$currentAppointment = $(e.target);\n    this.option(\"focusedElement\", getPublicElement($(e.target)));\n  }\n\n  _focusOutHandler(e) {\n    var $appointment = this._getAppointmentByIndex(0);\n\n    this.option(\"focusedElement\", getPublicElement($appointment));\n\n    super._focusOutHandler(e);\n  }\n\n  _eventBindingTarget() {\n    return this._itemContainer();\n  }\n\n  _getDefaultOptions() {\n    return extend(super._getDefaultOptions(), {\n      noDataText: null,\n      activeStateEnabled: true,\n      hoverStateEnabled: true,\n      tabIndex: 0,\n      fixedContainer: null,\n      allDayContainer: null,\n      allowDrag: true,\n      allowResize: true,\n      allowAllDayResize: true,\n      onAppointmentDblClick: null,\n      _collectorOffset: 0\n    });\n  }\n\n  _optionChanged(args) {\n    switch (args.name) {\n      case \"items\":\n        this._cleanFocusState();\n\n        this._clearDropDownItems();\n\n        this._clearDropDownItemsElements();\n\n        this._repaintAppointments(args.value);\n\n        this._renderDropDownAppointments();\n\n        this._attachAppointmentsEvents();\n\n        break;\n\n      case \"fixedContainer\":\n      case \"allDayContainer\":\n      case \"onAppointmentDblClick\":\n        break;\n\n      case \"allowDrag\":\n      case \"allowResize\":\n      case \"allowAllDayResize\":\n        this._invalidate();\n\n        break;\n\n      case \"focusedElement\":\n        this._resetTabIndex($(args.value));\n\n        super._optionChanged(args);\n\n        break;\n\n      case \"allowDelete\":\n        break;\n\n      case \"focusStateEnabled\":\n        this._clearDropDownItemsElements();\n\n        this._renderDropDownAppointments();\n\n        super._optionChanged(args);\n\n        break;\n\n      default:\n        super._optionChanged(args);\n\n    }\n  }\n\n  _isAllDayAppointment(appointment) {\n    return appointment.settings.length && appointment.settings[0].allDay || false;\n  }\n\n  _isRepaintAppointment(appointment) {\n    return !isDefined(appointment.needRepaint) || true === appointment.needRepaint;\n  }\n\n  _isRepaintAll(appointments) {\n    if (this.isAgendaView) {\n      return true;\n    }\n\n    for (var i = 0; i < appointments.length; i++) {\n      if (!this._isRepaintAppointment(appointments[i])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  _applyFragment(fragment, allDay) {\n    if (fragment.children().length > 0) {\n      this._getAppointmentContainer(allDay).append(fragment);\n    }\n  }\n\n  _onEachAppointment(appointment, index, container, isRepaintAll) {\n    if (true === (null === appointment || void 0 === appointment ? void 0 : appointment.needRemove)) {\n      this._clearItem(appointment);\n    } else if (isRepaintAll || this._isRepaintAppointment(appointment)) {\n      (() => {\n        appointment.needRepaint = false;\n\n        this._clearItem(appointment);\n\n        this._renderItem(index, appointment, container);\n      })();\n    }\n  }\n\n  _repaintAppointments(appointments) {\n    this._renderByFragments(($commonFragment, $allDayFragment) => {\n      var isRepaintAll = this._isRepaintAll(appointments);\n\n      if (isRepaintAll) {\n        this._getAppointmentContainer(true).html(\"\");\n\n        this._getAppointmentContainer(false).html(\"\");\n      }\n\n      !appointments.length && this._cleanItemContainer();\n      appointments.forEach((appointment, index) => {\n        var container = this._isAllDayAppointment(appointment) ? $allDayFragment : $commonFragment;\n\n        this._onEachAppointment(appointment, index, container, isRepaintAll);\n      });\n    });\n  }\n\n  _renderByFragments(renderFunction) {\n    if (this.isVirtualScrolling) {\n      var $commonFragment = $(domAdapter.createDocumentFragment());\n      var $allDayFragment = $(domAdapter.createDocumentFragment());\n      renderFunction($commonFragment, $allDayFragment);\n\n      this._applyFragment($commonFragment, false);\n\n      this._applyFragment($allDayFragment, true);\n    } else {\n      renderFunction(this._getAppointmentContainer(false), this._getAppointmentContainer(true));\n    }\n  }\n\n  _attachAppointmentsEvents() {\n    this._attachClickEvent();\n\n    this._attachHoldEvent();\n\n    this._attachContextMenuEvent();\n\n    this._attachAppointmentDblClick();\n\n    this._renderFocusState();\n\n    this._attachFeedbackEvents();\n\n    this._attachHoverEvents();\n  }\n\n  _clearItem(item) {\n    var $items = this._findItemElementByItem(item.itemData);\n\n    if (!$items.length) {\n      return;\n    }\n\n    each($items, function (_, $item) {\n      $item.detach();\n      $item.remove();\n    });\n  }\n\n  _clearDropDownItems() {\n    this._virtualAppointments = {};\n  }\n\n  _clearDropDownItemsElements() {\n    this.invoke(\"clearCompactAppointments\");\n  }\n\n  _findItemElementByItem(item) {\n    var result = [];\n    var that = this;\n    this.itemElements().each(function () {\n      var $item = $(this);\n\n      if ($item.data(that._itemDataKey()) === item) {\n        result.push($item);\n      }\n    });\n    return result;\n  }\n\n  _itemClass() {\n    return APPOINTMENT_ITEM_CLASS;\n  }\n\n  _itemContainer() {\n    var $container = super._itemContainer();\n\n    var $result = $container;\n    var $allDayContainer = this.option(\"allDayContainer\");\n\n    if ($allDayContainer) {\n      $result = $container.add($allDayContainer);\n    }\n\n    return $result;\n  }\n\n  _cleanItemContainer() {\n    super._cleanItemContainer();\n\n    var $allDayContainer = this.option(\"allDayContainer\");\n\n    if ($allDayContainer) {\n      $allDayContainer.empty();\n    }\n\n    this._virtualAppointments = {};\n  }\n\n  _clean() {\n    super._clean();\n\n    delete this._$currentAppointment;\n    delete this._initialSize;\n    delete this._initialCoordinates;\n  }\n\n  _init() {\n    super._init();\n\n    this.$element().addClass(COMPONENT_CLASS);\n    this._preventSingleAppointmentClick = false;\n  }\n\n  _renderAppointmentTemplate($container, appointment, model) {\n    var config = {\n      isAllDay: appointment.allDay,\n      isRecurrence: appointment.recurrenceRule,\n      html: isPlainObject(appointment) && appointment.html ? appointment.html : void 0\n    };\n    var formatText = this.invoke(\"getTextAndFormatDate\", model.appointmentData, this._currentAppointmentSettings.agendaSettings || model.targetedAppointmentData, \"TIME\");\n    $container.append(this.isAgendaView ? createAgendaAppointmentLayout(formatText, config) : createAppointmentLayout(formatText, config));\n  }\n\n  _executeItemRenderAction(index, itemData, itemElement) {\n    var action = this._getItemRenderAction();\n\n    if (action) {\n      action(this.invoke(\"mapAppointmentFields\", {\n        itemData: itemData,\n        itemElement: itemElement\n      }));\n    }\n\n    delete this._currentAppointmentSettings;\n  }\n\n  _itemClickHandler(e) {\n    super._itemClickHandler(e, {}, {\n      afterExecute: function (e) {\n        this._processItemClick(e.args[0].event);\n      }.bind(this)\n    });\n  }\n\n  _processItemClick(e) {\n    var $target = $(e.currentTarget);\n\n    var data = this._getItemData($target);\n\n    if (\"keydown\" === e.type || isFakeClickEvent(e)) {\n      this.notifyObserver(\"showEditAppointmentPopup\", {\n        data: data,\n        target: $target\n      });\n      return;\n    }\n\n    this._appointmentClickTimeout = setTimeout(function () {\n      if (!this._preventSingleAppointmentClick && domAdapter.getBody().contains($target[0])) {\n        this.notifyObserver(\"showAppointmentTooltip\", {\n          data: data,\n          target: $target\n        });\n      }\n\n      this._preventSingleAppointmentClick = false;\n    }.bind(this), 300);\n  }\n\n  _extendActionArgs($itemElement) {\n    var args = super._extendActionArgs($itemElement);\n\n    return this.invoke(\"mapAppointmentFields\", args);\n  }\n\n  _render() {\n    super._render();\n\n    this._attachAppointmentDblClick();\n  }\n\n  _attachAppointmentDblClick() {\n    var that = this;\n\n    var itemSelector = that._itemSelector();\n\n    var itemContainer = this._itemContainer();\n\n    eventsEngine.off(itemContainer, DBLCLICK_EVENT_NAME, itemSelector);\n    eventsEngine.on(itemContainer, DBLCLICK_EVENT_NAME, itemSelector, function (e) {\n      that._itemDXEventHandler(e, \"onAppointmentDblClick\", {}, {\n        afterExecute: function (e) {\n          that._dblClickHandler(e.args[0].event);\n        }\n      });\n    });\n  }\n\n  _dblClickHandler(e) {\n    var $targetAppointment = $(e.currentTarget);\n\n    var appointmentData = this._getItemData($targetAppointment);\n\n    clearTimeout(this._appointmentClickTimeout);\n    this._preventSingleAppointmentClick = true;\n    this.notifyObserver(\"showEditAppointmentPopup\", {\n      data: appointmentData,\n      target: $targetAppointment\n    });\n  }\n\n  _renderItem(index, item, container) {\n    var itemData = item.itemData;\n    var $items = [];\n\n    for (var i = 0; i < item.settings.length; i++) {\n      var setting = item.settings[i];\n      this._currentAppointmentSettings = setting;\n\n      var $item = super._renderItem(index, itemData, container);\n\n      $item.data(APPOINTMENT_SETTINGS_KEY, setting);\n      $items.push($item);\n    }\n\n    return $items;\n  }\n\n  _getItemContent($itemFrame) {\n    $itemFrame.data(APPOINTMENT_SETTINGS_KEY, this._currentAppointmentSettings);\n\n    var $itemContent = super._getItemContent($itemFrame);\n\n    return $itemContent;\n  }\n\n  _createItemByTemplate(itemTemplate, renderArgs) {\n    var {\n      itemData: itemData,\n      container: container,\n      index: index\n    } = renderArgs;\n    return itemTemplate.render({\n      model: {\n        appointmentData: itemData,\n        targetedAppointmentData: this.invoke(\"getTargetedAppointmentData\", itemData, $(container).parent())\n      },\n      container: container,\n      index: index\n    });\n  }\n\n  _getAppointmentContainer(allDay) {\n    var $allDayContainer = this.option(\"allDayContainer\");\n    var $container = this.itemsContainer().not($allDayContainer);\n\n    if (allDay && $allDayContainer) {\n      $container = $allDayContainer;\n    }\n\n    return $container;\n  }\n\n  _postprocessRenderItem(args) {\n    this._renderAppointment(args.itemElement, this._currentAppointmentSettings);\n  }\n\n  _renderAppointment(element, settings) {\n    element.data(APPOINTMENT_SETTINGS_KEY, settings);\n\n    this._applyResourceDataAttr(element);\n\n    var rawAppointment = this._getItemData(element);\n\n    var geometry = this.invoke(\"getAppointmentGeometry\", settings);\n    var allowResize = this.option(\"allowResize\") && (!isDefined(settings.skipResizing) || isString(settings.skipResizing));\n    var allowDrag = this.option(\"allowDrag\");\n    var allDay = settings.allDay;\n    this.invoke(\"setCellDataCacheAlias\", this._currentAppointmentSettings, geometry);\n\n    if (settings.virtual) {\n      var deferredColor = this.invoke(\"getAppointmentColor\", {\n        itemData: rawAppointment,\n        groupIndex: settings.groupIndex\n      });\n\n      this._processVirtualAppointment(settings, element, rawAppointment, deferredColor);\n    } else {\n      var _settings$info;\n\n      var config = {\n        data: rawAppointment,\n        groupIndex: settings.groupIndex,\n        observer: this.option(\"observer\"),\n        geometry: geometry,\n        direction: settings.direction || \"vertical\",\n        allowResize: allowResize,\n        allowDrag: allowDrag,\n        allDay: allDay,\n        reduced: settings.appointmentReduced,\n        isCompact: settings.isCompact,\n        startDate: new Date(null === (_settings$info = settings.info) || void 0 === _settings$info ? void 0 : _settings$info.appointment.startDate),\n        cellWidth: this.invoke(\"getCellWidth\"),\n        cellHeight: this.invoke(\"getCellHeight\"),\n        resizableConfig: this._resizableConfig(rawAppointment, settings)\n      };\n\n      if (this.isAgendaView) {\n        config.createPlainResourceListAsync = rawAppointment => this.resourceManager._createPlainResourcesByAppointmentAsync(rawAppointment);\n      }\n\n      this._createComponent(element, this.isAgendaView ? AgendaAppointment : Appointment, config);\n    }\n  }\n\n  _applyResourceDataAttr($appointment) {\n    var resources = this.invoke(\"getResourcesFromItem\", this._getItemData($appointment));\n\n    if (resources) {\n      each(resources, function (name, values) {\n        var attr = \"data-\" + normalizeKey(name.toLowerCase()) + \"-\";\n\n        for (var i = 0; i < values.length; i++) {\n          $appointment.attr(attr + normalizeKey(values[i]), true);\n        }\n      });\n    }\n  }\n\n  _resizableConfig(appointmentData, itemSetting) {\n    return {\n      area: this._calculateResizableArea(itemSetting, appointmentData),\n      onResizeStart: function (e) {\n        this._$currentAppointment = $(e.element);\n\n        if (this.invoke(\"needRecalculateResizableArea\")) {\n          var updatedArea = this._calculateResizableArea(this._$currentAppointment.data(APPOINTMENT_SETTINGS_KEY), this._$currentAppointment.data(\"dxItemData\"));\n\n          e.component.option(\"area\", updatedArea);\n\n          e.component._renderDragOffsets(e.event);\n        }\n\n        this._initialSize = {\n          width: e.width,\n          height: e.height\n        };\n        this._initialCoordinates = locate(this._$currentAppointment);\n      }.bind(this),\n      onResizeEnd: function (e) {\n        if (this._escPressed) {\n          e.event.cancel = true;\n          return;\n        }\n\n        this._resizeEndHandler(e);\n      }.bind(this)\n    };\n  }\n\n  _calculateResizableArea(itemSetting, appointmentData) {\n    var area = this.$element().closest(\".dx-scrollable-content\");\n    return this.invoke(\"getResizableAppointmentArea\", {\n      coordinates: {\n        left: itemSetting.left,\n        top: 0,\n        groupIndex: itemSetting.groupIndex\n      },\n      allDay: itemSetting.allDay\n    }) || area;\n  }\n\n  _resizeEndHandler(e) {\n    var scheduler = this.option(\"observer\");\n    var $element = $(e.element);\n    var {\n      info: info\n    } = $element.data(\"dxAppointmentSettings\");\n\n    var sourceAppointment = this._getItemData($element);\n\n    var modifiedAppointmentAdapter = scheduler.createAppointmentAdapter(sourceAppointment).clone();\n\n    var startDate = this._getEndResizeAppointmentStartDate(e, sourceAppointment, info.appointment);\n\n    var endDate = info.appointment.endDate;\n\n    var dateRange = this._getDateRange(e, startDate, endDate);\n\n    modifiedAppointmentAdapter.startDate = new Date(dateRange[0]);\n    modifiedAppointmentAdapter.endDate = new Date(dateRange[1]);\n    this.notifyObserver(\"updateAppointmentAfterResize\", {\n      target: sourceAppointment,\n      data: modifiedAppointmentAdapter.clone({\n        pathTimeZone: \"fromGrid\"\n      }).source(),\n      $appointment: $element\n    });\n  }\n\n  _getEndResizeAppointmentStartDate(e, rawAppointment, appointmentInfo) {\n    var scheduler = this.option(\"observer\");\n    var appointmentAdapter = scheduler.createAppointmentAdapter(rawAppointment);\n    var startDate = appointmentInfo.startDate;\n    var recurrenceProcessor = getRecurrenceProcessor();\n    var {\n      recurrenceRule: recurrenceRule,\n      startDateTimeZone: startDateTimeZone\n    } = appointmentAdapter;\n    var isAllDay = this.invoke(\"isAllDay\", rawAppointment);\n    var isRecurrent = recurrenceProcessor.isValidRecurrenceRule(recurrenceRule);\n\n    if (!e.handles.top && !isRecurrent && !isAllDay) {\n      startDate = scheduler.timeZoneCalculator.createDate(appointmentAdapter.startDate, {\n        appointmentTimeZone: startDateTimeZone,\n        path: \"toGrid\"\n      });\n    }\n\n    return startDate;\n  }\n\n  _getDateRange(e, startDate, endDate) {\n    var itemData = this._getItemData(e.element);\n\n    var deltaTime = this.invoke(\"getDeltaTime\", e, this._initialSize, itemData);\n    var renderingStrategyDirection = this.invoke(\"getRenderingStrategyDirection\");\n    var isStartDateChanged = false;\n    var isAllDay = this.invoke(\"isAllDay\", itemData);\n    var needCorrectDates = this.invoke(\"needCorrectAppointmentDates\") && !isAllDay;\n    var startTime;\n    var endTime;\n\n    if (\"vertical\" !== renderingStrategyDirection || isAllDay) {\n      isStartDateChanged = this.option(\"rtlEnabled\") ? e.handles.right : e.handles.left;\n    } else {\n      isStartDateChanged = e.handles.top;\n    }\n\n    if (isStartDateChanged) {\n      startTime = needCorrectDates ? this._correctStartDateByDelta(startDate, deltaTime) : startDate.getTime() - deltaTime;\n      startTime += timeZoneUtils.getTimezoneOffsetChangeInMs(startDate, endDate, startTime, endDate);\n      endTime = endDate.getTime();\n    } else {\n      startTime = startDate.getTime();\n      endTime = needCorrectDates ? this._correctEndDateByDelta(endDate, deltaTime) : endDate.getTime() + deltaTime;\n      endTime -= timeZoneUtils.getTimezoneOffsetChangeInMs(startDate, endDate, startDate, endTime);\n    }\n\n    return [startTime, endTime];\n  }\n\n  _correctEndDateByDelta(endDate, deltaTime) {\n    var endDayHour = this.invoke(\"getEndDayHour\");\n    var startDayHour = this.invoke(\"getStartDayHour\");\n    var result = endDate.getTime() + deltaTime;\n    var visibleDayDuration = (endDayHour - startDayHour) * toMs(\"hour\");\n    var daysCount = deltaTime > 0 ? Math.ceil(deltaTime / visibleDayDuration) : Math.floor(deltaTime / visibleDayDuration);\n    var maxDate = new Date(endDate);\n    var minDate = new Date(endDate);\n    minDate.setHours(startDayHour, 0, 0, 0);\n    maxDate.setHours(endDayHour, 0, 0, 0);\n\n    if (result > maxDate.getTime() || result <= minDate.getTime()) {\n      var tailOfCurrentDay = maxDate.getTime() - endDate.getTime();\n      var tailOfPrevDays = deltaTime - tailOfCurrentDay;\n      var lastDay = new Date(endDate.setDate(endDate.getDate() + daysCount));\n      lastDay.setHours(startDayHour, 0, 0, 0);\n      result = lastDay.getTime() + tailOfPrevDays - visibleDayDuration * (daysCount - 1);\n    }\n\n    return result;\n  }\n\n  _correctStartDateByDelta(startDate, deltaTime) {\n    var endDayHour = this.invoke(\"getEndDayHour\");\n    var startDayHour = this.invoke(\"getStartDayHour\");\n    var result = startDate.getTime() - deltaTime;\n    var visibleDayDuration = (endDayHour - startDayHour) * toMs(\"hour\");\n    var daysCount = deltaTime > 0 ? Math.ceil(deltaTime / visibleDayDuration) : Math.floor(deltaTime / visibleDayDuration);\n    var maxDate = new Date(startDate);\n    var minDate = new Date(startDate);\n    minDate.setHours(startDayHour, 0, 0, 0);\n    maxDate.setHours(endDayHour, 0, 0, 0);\n\n    if (result < minDate.getTime() || result >= maxDate.getTime()) {\n      var tailOfCurrentDay = startDate.getTime() - minDate.getTime();\n      var tailOfPrevDays = deltaTime - tailOfCurrentDay;\n      var firstDay = new Date(startDate.setDate(startDate.getDate() - daysCount));\n      firstDay.setHours(endDayHour, 0, 0, 0);\n      result = firstDay.getTime() - tailOfPrevDays + visibleDayDuration * (daysCount - 1);\n    }\n\n    return result;\n  }\n\n  _processVirtualAppointment(appointmentSetting, $appointment, appointmentData, color) {\n    var virtualAppointment = appointmentSetting.virtual;\n    var virtualGroupIndex = virtualAppointment.index;\n\n    if (!isDefined(this._virtualAppointments[virtualGroupIndex])) {\n      this._virtualAppointments[virtualGroupIndex] = {\n        coordinates: {\n          top: virtualAppointment.top,\n          left: virtualAppointment.left\n        },\n        items: {\n          data: [],\n          colors: [],\n          settings: []\n        },\n        isAllDay: virtualAppointment.isAllDay ? true : false,\n        buttonColor: color\n      };\n    }\n\n    appointmentSetting.targetedAppointmentData = this.invoke(\"getTargetedAppointmentData\", appointmentData, $appointment);\n\n    this._virtualAppointments[virtualGroupIndex].items.settings.push(appointmentSetting);\n\n    this._virtualAppointments[virtualGroupIndex].items.data.push(appointmentData);\n\n    this._virtualAppointments[virtualGroupIndex].items.colors.push(color);\n\n    $appointment.remove();\n  }\n\n  _renderContentImpl() {\n    super._renderContentImpl();\n\n    this._renderDropDownAppointments();\n  }\n\n  _renderDropDownAppointments() {\n    this._renderByFragments(($commonFragment, $allDayFragment) => {\n      each(this._virtualAppointments, function (groupIndex) {\n        var virtualGroup = this._virtualAppointments[groupIndex];\n        var virtualItems = virtualGroup.items;\n        var virtualCoordinates = virtualGroup.coordinates;\n        var $fragment = virtualGroup.isAllDay ? $allDayFragment : $commonFragment;\n        var left = virtualCoordinates.left;\n        var buttonWidth = this.invoke(\"getDropDownAppointmentWidth\", virtualGroup.isAllDay);\n        var buttonHeight = this.invoke(\"getDropDownAppointmentHeight\");\n        var rtlOffset = this.option(\"rtlEnabled\") ? buttonWidth : 0;\n        this.notifyObserver(\"renderCompactAppointments\", {\n          $container: $fragment,\n          coordinates: {\n            top: virtualCoordinates.top,\n            left: left + rtlOffset\n          },\n          items: virtualItems,\n          buttonColor: virtualGroup.buttonColor,\n          width: buttonWidth - this.option(\"_collectorOffset\"),\n          height: buttonHeight,\n          onAppointmentClick: this.option(\"onItemClick\"),\n          allowDrag: this.option(\"allowDrag\"),\n          cellWidth: this.invoke(\"getCellWidth\"),\n          isCompact: this.invoke(\"isAdaptive\") || this._isGroupCompact(virtualGroup),\n          applyOffset: !virtualGroup.isAllDay && this.invoke(\"isApplyCompactAppointmentOffset\")\n        });\n      }.bind(this));\n    });\n  }\n\n  _isGroupCompact(virtualGroup) {\n    return !virtualGroup.isAllDay && this.invoke(\"supportCompactDropDownAppointments\");\n  }\n\n  _sortAppointmentsByStartDate(appointments) {\n    appointments.sort(function (a, b) {\n      var result = 0;\n      var firstDate = new Date(this.invoke(\"getField\", \"startDate\", a.settings || a)).getTime();\n      var secondDate = new Date(this.invoke(\"getField\", \"startDate\", b.settings || b)).getTime();\n\n      if (firstDate < secondDate) {\n        result = -1;\n      }\n\n      if (firstDate > secondDate) {\n        result = 1;\n      }\n\n      return result;\n    }.bind(this));\n  }\n\n  _processRecurrenceAppointment(appointment, index, skipLongAppointments) {\n    var recurrenceRule = this.invoke(\"getField\", \"recurrenceRule\", appointment);\n    var result = {\n      parts: [],\n      indexes: []\n    };\n\n    if (recurrenceRule) {\n      var dates = appointment.settings || appointment;\n      var startDate = new Date(this.invoke(\"getField\", \"startDate\", dates));\n      var endDate = new Date(this.invoke(\"getField\", \"endDate\", dates));\n      var appointmentDuration = endDate.getTime() - startDate.getTime();\n      var recurrenceException = this.invoke(\"getField\", \"recurrenceException\", appointment);\n      var startViewDate = this.invoke(\"getStartViewDate\");\n      var endViewDate = this.invoke(\"getEndViewDate\");\n      var recurrentDates = getRecurrenceProcessor().generateDates({\n        rule: recurrenceRule,\n        exception: recurrenceException,\n        start: startDate,\n        end: endDate,\n        min: startViewDate,\n        max: endViewDate\n      });\n      var recurrentDateCount = appointment.settings ? 1 : recurrentDates.length;\n\n      for (var i = 0; i < recurrentDateCount; i++) {\n        var appointmentPart = extend({}, appointment, true);\n\n        if (recurrentDates[i]) {\n          var appointmentSettings = this._applyStartDateToObj(recurrentDates[i], {});\n\n          this._applyEndDateToObj(new Date(recurrentDates[i].getTime() + appointmentDuration), appointmentSettings);\n\n          appointmentPart.settings = appointmentSettings;\n        } else {\n          appointmentPart.settings = dates;\n        }\n\n        result.parts.push(appointmentPart);\n\n        if (!skipLongAppointments) {\n          this._processLongAppointment(appointmentPart, result);\n        }\n      }\n\n      result.indexes.push(index);\n    }\n\n    return result;\n  }\n\n  _processLongAppointment(appointment, result) {\n    var parts = this.splitAppointmentByDay(appointment);\n    var partCount = parts.length;\n    var endViewDate = this.invoke(\"getEndViewDate\").getTime();\n    var startViewDate = this.invoke(\"getStartViewDate\").getTime();\n    var timeZoneCalculator = this.invoke(\"getTimeZoneCalculator\");\n    result = result || {\n      parts: []\n    };\n\n    if (partCount > 1) {\n      extend(appointment, parts[0]);\n\n      for (var i = 1; i < partCount; i++) {\n        var startDate = this.invoke(\"getField\", \"startDate\", parts[i].settings).getTime();\n        startDate = timeZoneCalculator.createDate(startDate, {\n          path: \"toGrid\"\n        });\n\n        if (startDate < endViewDate && startDate > startViewDate) {\n          result.parts.push(parts[i]);\n        }\n      }\n    }\n\n    return result;\n  }\n\n  _reduceRecurrenceAppointments(recurrenceIndexes, appointments) {\n    each(recurrenceIndexes, function (i, index) {\n      appointments.splice(index - i, 1);\n    });\n  }\n\n  _combineAppointments(appointments, additionalAppointments) {\n    if (additionalAppointments.length) {\n      merge(appointments, additionalAppointments);\n    }\n\n    this._sortAppointmentsByStartDate(appointments);\n  }\n\n  _applyStartDateToObj(startDate, obj) {\n    this.invoke(\"setField\", \"startDate\", obj, startDate);\n    return obj;\n  }\n\n  _applyEndDateToObj(endDate, obj) {\n    this.invoke(\"setField\", \"endDate\", obj, endDate);\n    return obj;\n  }\n\n  moveAppointmentBack(dragEvent) {\n    var $appointment = this._$currentAppointment;\n    var size = this._initialSize;\n    var coords = this._initialCoordinates;\n\n    if (dragEvent) {\n      this._removeDragSourceClassFromDraggedAppointment();\n\n      if (isDeferred(dragEvent.cancel)) {\n        dragEvent.cancel.resolve(true);\n      } else {\n        dragEvent.cancel = true;\n      }\n    }\n\n    if ($appointment && !dragEvent) {\n      if (coords) {\n        move($appointment, coords);\n        delete this._initialSize;\n      }\n\n      if (size) {\n        $appointment.outerWidth(size.width);\n        $appointment.outerHeight(size.height);\n        delete this._initialCoordinates;\n      }\n    }\n  }\n\n  focus() {\n    if (this._$currentAppointment) {\n      var focusedElement = getPublicElement(this._$currentAppointment);\n      this.option(\"focusedElement\", focusedElement);\n      eventsEngine.trigger(focusedElement, \"focus\");\n    }\n  }\n\n  splitAppointmentByDay(appointment) {\n    var dates = appointment.settings || appointment;\n    var originalStartDate = new Date(this.invoke(\"getField\", \"startDate\", dates));\n    var startDate = dateUtils.makeDate(originalStartDate);\n    var endDate = dateUtils.makeDate(this.invoke(\"getField\", \"endDate\", dates));\n    var maxAllowedDate = this.invoke(\"getEndViewDate\");\n    var startDayHour = this.invoke(\"getStartDayHour\");\n    var endDayHour = this.invoke(\"getEndDayHour\");\n    var appointmentIsLong = this.invoke(\"appointmentTakesSeveralDays\", appointment);\n    var result = [];\n    var timeZoneCalculator = this.invoke(\"getTimeZoneCalculator\");\n    startDate = timeZoneCalculator.createDate(startDate, {\n      path: \"toGrid\"\n    });\n    endDate = timeZoneCalculator.createDate(endDate, {\n      path: \"toGrid\"\n    });\n\n    if (startDate.getHours() <= endDayHour && startDate.getHours() >= startDayHour && !appointmentIsLong) {\n      result.push(this._applyStartDateToObj(new Date(startDate), {\n        appointmentData: appointment\n      }));\n      startDate.setDate(startDate.getDate() + 1);\n    }\n\n    while (appointmentIsLong && startDate.getTime() < endDate.getTime() && startDate < maxAllowedDate) {\n      var currentStartDate = new Date(startDate);\n      var currentEndDate = new Date(startDate);\n\n      this._checkStartDate(currentStartDate, originalStartDate, startDayHour);\n\n      this._checkEndDate(currentEndDate, endDate, endDayHour);\n\n      var appointmentData = deepExtendArraySafe({}, appointment, true);\n      var appointmentSettings = {};\n\n      this._applyStartDateToObj(currentStartDate, appointmentSettings);\n\n      this._applyEndDateToObj(currentEndDate, appointmentSettings);\n\n      appointmentData.settings = appointmentSettings;\n      result.push(appointmentData);\n      startDate = dateUtils.trimTime(startDate);\n      startDate.setDate(startDate.getDate() + 1);\n      startDate.setHours(startDayHour);\n    }\n\n    return result;\n  }\n\n  _checkStartDate(currentDate, originalDate, startDayHour) {\n    if (!dateUtils.sameDate(currentDate, originalDate) || currentDate.getHours() <= startDayHour) {\n      currentDate.setHours(startDayHour, 0, 0, 0);\n    } else {\n      currentDate.setHours(originalDate.getHours(), originalDate.getMinutes(), originalDate.getSeconds(), originalDate.getMilliseconds());\n    }\n  }\n\n  _checkEndDate(currentDate, originalDate, endDayHour) {\n    if (!dateUtils.sameDate(currentDate, originalDate) || currentDate.getHours() > endDayHour) {\n      currentDate.setHours(endDayHour, 0, 0, 0);\n    } else {\n      currentDate.setHours(originalDate.getHours(), originalDate.getMinutes(), originalDate.getSeconds(), originalDate.getMilliseconds());\n    }\n  }\n\n  _removeDragSourceClassFromDraggedAppointment() {\n    var $appointments = this._itemElements().filter(\".\".concat(APPOINTMENT_DRAG_SOURCE_CLASS));\n\n    $appointments.each((_, element) => {\n      var appointmentInstance = $(element).dxSchedulerAppointment(\"instance\");\n      appointmentInstance.option(\"isDragSource\", false);\n    });\n  }\n\n  _setDragSourceAppointment(appointment, settings) {\n    var $appointments = this._findItemElementByItem(appointment);\n\n    var {\n      startDate: startDate,\n      endDate: endDate\n    } = settings.info.sourceAppointment;\n    var {\n      groupIndex: groupIndex\n    } = settings;\n    $appointments.forEach($item => {\n      var {\n        info: itemInfo,\n        groupIndex: itemGroupIndex\n      } = $item.data(APPOINTMENT_SETTINGS_KEY);\n      var {\n        startDate: itemStartDate,\n        endDate: itemEndDate\n      } = itemInfo.sourceAppointment;\n      var appointmentInstance = $item.dxSchedulerAppointment(\"instance\");\n      var isDragSource = startDate.getTime() === itemStartDate.getTime() && endDate.getTime() === itemEndDate.getTime() && groupIndex === itemGroupIndex;\n      appointmentInstance.option(\"isDragSource\", isDragSource);\n    });\n  }\n\n}\n\nregisterComponent(\"dxSchedulerAppointments\", SchedulerAppointments);\nexport default SchedulerAppointments;","map":{"version":3,"sources":["/home/igor/node_modules/devextreme/esm/ui/scheduler/appointments/appointmentCollection.js"],"names":["$","domAdapter","eventsEngine","data","elementData","locate","move","dateUtils","normalizeKey","isDefined","isDeferred","isString","isPlainObject","each","deepExtendArraySafe","merge","extend","getPublicElement","getRecurrenceProcessor","registerComponent","Appointment","AgendaAppointment","addNamespace","isFakeClickEvent","name","dblclickEvent","CollectionWidget","timeZoneUtils","APPOINTMENT_ITEM_CLASS","APPOINTMENT_DRAG_SOURCE_CLASS","APPOINTMENT_SETTINGS_KEY","createAgendaAppointmentLayout","createAppointmentLayout","COMPONENT_CLASS","DBLCLICK_EVENT_NAME","toMs","dateToMilliseconds","SchedulerAppointments","isAgendaView","invoke","isVirtualScrolling","resourceManager","option","_resourcesManager","constructor","element","options","_virtualAppointments","notifyObserver","subject","args","observer","fire","apply","arguments","_supportedKeys","parent","escape","moveAppointmentBack","_escPressed","bind","del","e","preventDefault","_getItemData","target","tab","appointments","_getAccessAppointments","focusedAppointment","filter","index","sortedIndex","lastIndex","length","shiftKey","$nextAppointment","_getAppointmentByIndex","_resetTabIndex","trigger","_","$item","eq","_itemElements","not","$appointment","_focusTarget","attr","_moveFocus","_renderFocusTarget","_focusInHandler","_$currentAppointment","_focusOutHandler","_eventBindingTarget","_itemContainer","_getDefaultOptions","noDataText","activeStateEnabled","hoverStateEnabled","tabIndex","fixedContainer","allDayContainer","allowDrag","allowResize","allowAllDayResize","onAppointmentDblClick","_collectorOffset","_optionChanged","_cleanFocusState","_clearDropDownItems","_clearDropDownItemsElements","_repaintAppointments","value","_renderDropDownAppointments","_attachAppointmentsEvents","_invalidate","_isAllDayAppointment","appointment","settings","allDay","_isRepaintAppointment","needRepaint","_isRepaintAll","i","_applyFragment","fragment","children","_getAppointmentContainer","append","_onEachAppointment","container","isRepaintAll","needRemove","_clearItem","_renderItem","_renderByFragments","$commonFragment","$allDayFragment","html","_cleanItemContainer","forEach","renderFunction","createDocumentFragment","_attachClickEvent","_attachHoldEvent","_attachContextMenuEvent","_attachAppointmentDblClick","_renderFocusState","_attachFeedbackEvents","_attachHoverEvents","item","$items","_findItemElementByItem","itemData","detach","remove","result","that","itemElements","_itemDataKey","push","_itemClass","$container","$result","$allDayContainer","add","empty","_clean","_initialSize","_initialCoordinates","_init","$element","addClass","_preventSingleAppointmentClick","_renderAppointmentTemplate","model","config","isAllDay","isRecurrence","recurrenceRule","formatText","appointmentData","_currentAppointmentSettings","agendaSettings","targetedAppointmentData","_executeItemRenderAction","itemElement","action","_getItemRenderAction","_itemClickHandler","afterExecute","_processItemClick","event","$target","currentTarget","type","_appointmentClickTimeout","setTimeout","getBody","contains","_extendActionArgs","$itemElement","_render","itemSelector","_itemSelector","itemContainer","off","on","_itemDXEventHandler","_dblClickHandler","$targetAppointment","clearTimeout","setting","_getItemContent","$itemFrame","$itemContent","_createItemByTemplate","itemTemplate","renderArgs","render","itemsContainer","_postprocessRenderItem","_renderAppointment","_applyResourceDataAttr","rawAppointment","geometry","skipResizing","virtual","deferredColor","groupIndex","_processVirtualAppointment","_settings$info","direction","reduced","appointmentReduced","isCompact","startDate","Date","info","cellWidth","cellHeight","resizableConfig","_resizableConfig","createPlainResourceListAsync","_createPlainResourcesByAppointmentAsync","_createComponent","resources","values","toLowerCase","itemSetting","area","_calculateResizableArea","onResizeStart","updatedArea","component","_renderDragOffsets","width","height","onResizeEnd","cancel","_resizeEndHandler","closest","coordinates","left","top","scheduler","sourceAppointment","modifiedAppointmentAdapter","createAppointmentAdapter","clone","_getEndResizeAppointmentStartDate","endDate","dateRange","_getDateRange","pathTimeZone","source","appointmentInfo","appointmentAdapter","recurrenceProcessor","startDateTimeZone","isRecurrent","isValidRecurrenceRule","handles","timeZoneCalculator","createDate","appointmentTimeZone","path","deltaTime","renderingStrategyDirection","isStartDateChanged","needCorrectDates","startTime","endTime","right","_correctStartDateByDelta","getTime","getTimezoneOffsetChangeInMs","_correctEndDateByDelta","endDayHour","startDayHour","visibleDayDuration","daysCount","Math","ceil","floor","maxDate","minDate","setHours","tailOfCurrentDay","tailOfPrevDays","lastDay","setDate","getDate","firstDay","appointmentSetting","color","virtualAppointment","virtualGroupIndex","items","colors","buttonColor","_renderContentImpl","virtualGroup","virtualItems","virtualCoordinates","$fragment","buttonWidth","buttonHeight","rtlOffset","onAppointmentClick","_isGroupCompact","applyOffset","_sortAppointmentsByStartDate","sort","a","b","firstDate","secondDate","_processRecurrenceAppointment","skipLongAppointments","parts","indexes","dates","appointmentDuration","recurrenceException","startViewDate","endViewDate","recurrentDates","generateDates","rule","exception","start","end","min","max","recurrentDateCount","appointmentPart","appointmentSettings","_applyStartDateToObj","_applyEndDateToObj","_processLongAppointment","splitAppointmentByDay","partCount","_reduceRecurrenceAppointments","recurrenceIndexes","splice","_combineAppointments","additionalAppointments","obj","dragEvent","size","coords","_removeDragSourceClassFromDraggedAppointment","resolve","outerWidth","outerHeight","focus","focusedElement","originalStartDate","makeDate","maxAllowedDate","appointmentIsLong","getHours","currentStartDate","currentEndDate","_checkStartDate","_checkEndDate","trimTime","currentDate","originalDate","sameDate","getMinutes","getSeconds","getMilliseconds","$appointments","concat","appointmentInstance","dxSchedulerAppointment","_setDragSourceAppointment","itemInfo","itemGroupIndex","itemStartDate","itemEndDate","isDragSource"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/appointments/appointmentCollection.js)\r\n * Version: 21.1.6\r\n * Build date: Mon Sep 27 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../../core/renderer\";\r\nimport domAdapter from \"../../../core/dom_adapter\";\r\nimport eventsEngine from \"../../../events/core/events_engine\";\r\nimport {\r\n    data as elementData\r\n} from \"../../../core/element_data\";\r\nimport {\r\n    locate,\r\n    move\r\n} from \"../../../animation/translator\";\r\nimport dateUtils from \"../../../core/utils/date\";\r\nimport {\r\n    normalizeKey\r\n} from \"../../../core/utils/common\";\r\nimport {\r\n    isDefined,\r\n    isDeferred,\r\n    isString,\r\n    isPlainObject\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    each\r\n} from \"../../../core/utils/iterator\";\r\nimport {\r\n    deepExtendArraySafe\r\n} from \"../../../core/utils/object\";\r\nimport {\r\n    merge\r\n} from \"../../../core/utils/array\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    getPublicElement\r\n} from \"../../../core/element\";\r\nimport {\r\n    getRecurrenceProcessor\r\n} from \"../recurrence\";\r\nimport registerComponent from \"../../../core/component_registrator\";\r\nimport {\r\n    Appointment,\r\n    AgendaAppointment\r\n} from \"./appointment\";\r\nimport {\r\n    addNamespace,\r\n    isFakeClickEvent\r\n} from \"../../../events/utils/index\";\r\nimport {\r\n    name as dblclickEvent\r\n} from \"../../../events/double_click\";\r\nimport CollectionWidget from \"../../collection/ui.collection_widget.edit\";\r\nimport timeZoneUtils from \"../utils.timeZone.js\";\r\nimport {\r\n    APPOINTMENT_ITEM_CLASS,\r\n    APPOINTMENT_DRAG_SOURCE_CLASS,\r\n    APPOINTMENT_SETTINGS_KEY\r\n} from \"../constants\";\r\nimport {\r\n    createAgendaAppointmentLayout,\r\n    createAppointmentLayout\r\n} from \"./appointmentLayout\";\r\nvar COMPONENT_CLASS = \"dx-scheduler-scrollable-appointments\";\r\nvar DBLCLICK_EVENT_NAME = addNamespace(dblclickEvent, \"dxSchedulerAppointment\");\r\nvar toMs = dateUtils.dateToMilliseconds;\r\nclass SchedulerAppointments extends CollectionWidget {\r\n    get isAgendaView() {\r\n        return this.invoke(\"isCurrentViewAgenda\")\r\n    }\r\n    get isVirtualScrolling() {\r\n        return this.invoke(\"isVirtualScrolling\")\r\n    }\r\n    get resourceManager() {\r\n        return this.option(\"observer\")._resourcesManager\r\n    }\r\n    constructor(element, options) {\r\n        super(element, options);\r\n        this._virtualAppointments = {}\r\n    }\r\n    notifyObserver(subject, args) {\r\n        var observer = this.option(\"observer\");\r\n        if (observer) {\r\n            observer.fire(subject, args)\r\n        }\r\n    }\r\n    invoke() {\r\n        var observer = this.option(\"observer\");\r\n        if (observer) {\r\n            return observer.fire.apply(observer, arguments)\r\n        }\r\n    }\r\n    _supportedKeys() {\r\n        var parent = super._supportedKeys();\r\n        return extend(parent, {\r\n            escape: function() {\r\n                this.moveAppointmentBack();\r\n                this._escPressed = true\r\n            }.bind(this),\r\n            del: function(e) {\r\n                if (this.option(\"allowDelete\")) {\r\n                    e.preventDefault();\r\n                    var data = this._getItemData(e.target);\r\n                    this.notifyObserver(\"onDeleteButtonPress\", {\r\n                        data: data,\r\n                        target: e.target\r\n                    })\r\n                }\r\n            }.bind(this),\r\n            tab: function(e) {\r\n                var appointments = this._getAccessAppointments();\r\n                var focusedAppointment = appointments.filter(\".dx-state-focused\");\r\n                var index = focusedAppointment.data(APPOINTMENT_SETTINGS_KEY).sortedIndex;\r\n                var lastIndex = appointments.length - 1;\r\n                if (index > 0 && e.shiftKey || index < lastIndex && !e.shiftKey) {\r\n                    e.preventDefault();\r\n                    e.shiftKey ? index-- : index++;\r\n                    var $nextAppointment = this._getAppointmentByIndex(index);\r\n                    this._resetTabIndex($nextAppointment);\r\n                    eventsEngine.trigger($nextAppointment, \"focus\")\r\n                }\r\n            }\r\n        })\r\n    }\r\n    _getAppointmentByIndex(sortedIndex) {\r\n        var appointments = this._getAccessAppointments();\r\n        return appointments.filter((function(_, $item) {\r\n            return elementData($item, APPOINTMENT_SETTINGS_KEY).sortedIndex === sortedIndex\r\n        })).eq(0)\r\n    }\r\n    _getAccessAppointments() {\r\n        return this._itemElements().filter(\":visible\").not(\".dx-state-disabled\")\r\n    }\r\n    _resetTabIndex($appointment) {\r\n        this._focusTarget().attr(\"tabIndex\", -1);\r\n        $appointment.attr(\"tabIndex\", this.option(\"tabIndex\"))\r\n    }\r\n    _moveFocus() {}\r\n    _focusTarget() {\r\n        return this._itemElements()\r\n    }\r\n    _renderFocusTarget() {\r\n        var $appointment = this._getAppointmentByIndex(0);\r\n        this._resetTabIndex($appointment)\r\n    }\r\n    _focusInHandler(e) {\r\n        super._focusInHandler(e);\r\n        this._$currentAppointment = $(e.target);\r\n        this.option(\"focusedElement\", getPublicElement($(e.target)))\r\n    }\r\n    _focusOutHandler(e) {\r\n        var $appointment = this._getAppointmentByIndex(0);\r\n        this.option(\"focusedElement\", getPublicElement($appointment));\r\n        super._focusOutHandler(e)\r\n    }\r\n    _eventBindingTarget() {\r\n        return this._itemContainer()\r\n    }\r\n    _getDefaultOptions() {\r\n        return extend(super._getDefaultOptions(), {\r\n            noDataText: null,\r\n            activeStateEnabled: true,\r\n            hoverStateEnabled: true,\r\n            tabIndex: 0,\r\n            fixedContainer: null,\r\n            allDayContainer: null,\r\n            allowDrag: true,\r\n            allowResize: true,\r\n            allowAllDayResize: true,\r\n            onAppointmentDblClick: null,\r\n            _collectorOffset: 0\r\n        })\r\n    }\r\n    _optionChanged(args) {\r\n        switch (args.name) {\r\n            case \"items\":\r\n                this._cleanFocusState();\r\n                this._clearDropDownItems();\r\n                this._clearDropDownItemsElements();\r\n                this._repaintAppointments(args.value);\r\n                this._renderDropDownAppointments();\r\n                this._attachAppointmentsEvents();\r\n                break;\r\n            case \"fixedContainer\":\r\n            case \"allDayContainer\":\r\n            case \"onAppointmentDblClick\":\r\n                break;\r\n            case \"allowDrag\":\r\n            case \"allowResize\":\r\n            case \"allowAllDayResize\":\r\n                this._invalidate();\r\n                break;\r\n            case \"focusedElement\":\r\n                this._resetTabIndex($(args.value));\r\n                super._optionChanged(args);\r\n                break;\r\n            case \"allowDelete\":\r\n                break;\r\n            case \"focusStateEnabled\":\r\n                this._clearDropDownItemsElements();\r\n                this._renderDropDownAppointments();\r\n                super._optionChanged(args);\r\n                break;\r\n            default:\r\n                super._optionChanged(args)\r\n        }\r\n    }\r\n    _isAllDayAppointment(appointment) {\r\n        return appointment.settings.length && appointment.settings[0].allDay || false\r\n    }\r\n    _isRepaintAppointment(appointment) {\r\n        return !isDefined(appointment.needRepaint) || true === appointment.needRepaint\r\n    }\r\n    _isRepaintAll(appointments) {\r\n        if (this.isAgendaView) {\r\n            return true\r\n        }\r\n        for (var i = 0; i < appointments.length; i++) {\r\n            if (!this._isRepaintAppointment(appointments[i])) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    }\r\n    _applyFragment(fragment, allDay) {\r\n        if (fragment.children().length > 0) {\r\n            this._getAppointmentContainer(allDay).append(fragment)\r\n        }\r\n    }\r\n    _onEachAppointment(appointment, index, container, isRepaintAll) {\r\n        if (true === (null === appointment || void 0 === appointment ? void 0 : appointment.needRemove)) {\r\n            this._clearItem(appointment)\r\n        } else if (isRepaintAll || this._isRepaintAppointment(appointment)) {\r\n            (() => {\r\n                appointment.needRepaint = false;\r\n                this._clearItem(appointment);\r\n                this._renderItem(index, appointment, container)\r\n            })()\r\n        }\r\n    }\r\n    _repaintAppointments(appointments) {\r\n        this._renderByFragments(($commonFragment, $allDayFragment) => {\r\n            var isRepaintAll = this._isRepaintAll(appointments);\r\n            if (isRepaintAll) {\r\n                this._getAppointmentContainer(true).html(\"\");\r\n                this._getAppointmentContainer(false).html(\"\")\r\n            }!appointments.length && this._cleanItemContainer();\r\n            appointments.forEach((appointment, index) => {\r\n                var container = this._isAllDayAppointment(appointment) ? $allDayFragment : $commonFragment;\r\n                this._onEachAppointment(appointment, index, container, isRepaintAll)\r\n            })\r\n        })\r\n    }\r\n    _renderByFragments(renderFunction) {\r\n        if (this.isVirtualScrolling) {\r\n            var $commonFragment = $(domAdapter.createDocumentFragment());\r\n            var $allDayFragment = $(domAdapter.createDocumentFragment());\r\n            renderFunction($commonFragment, $allDayFragment);\r\n            this._applyFragment($commonFragment, false);\r\n            this._applyFragment($allDayFragment, true)\r\n        } else {\r\n            renderFunction(this._getAppointmentContainer(false), this._getAppointmentContainer(true))\r\n        }\r\n    }\r\n    _attachAppointmentsEvents() {\r\n        this._attachClickEvent();\r\n        this._attachHoldEvent();\r\n        this._attachContextMenuEvent();\r\n        this._attachAppointmentDblClick();\r\n        this._renderFocusState();\r\n        this._attachFeedbackEvents();\r\n        this._attachHoverEvents()\r\n    }\r\n    _clearItem(item) {\r\n        var $items = this._findItemElementByItem(item.itemData);\r\n        if (!$items.length) {\r\n            return\r\n        }\r\n        each($items, (function(_, $item) {\r\n            $item.detach();\r\n            $item.remove()\r\n        }))\r\n    }\r\n    _clearDropDownItems() {\r\n        this._virtualAppointments = {}\r\n    }\r\n    _clearDropDownItemsElements() {\r\n        this.invoke(\"clearCompactAppointments\")\r\n    }\r\n    _findItemElementByItem(item) {\r\n        var result = [];\r\n        var that = this;\r\n        this.itemElements().each((function() {\r\n            var $item = $(this);\r\n            if ($item.data(that._itemDataKey()) === item) {\r\n                result.push($item)\r\n            }\r\n        }));\r\n        return result\r\n    }\r\n    _itemClass() {\r\n        return APPOINTMENT_ITEM_CLASS\r\n    }\r\n    _itemContainer() {\r\n        var $container = super._itemContainer();\r\n        var $result = $container;\r\n        var $allDayContainer = this.option(\"allDayContainer\");\r\n        if ($allDayContainer) {\r\n            $result = $container.add($allDayContainer)\r\n        }\r\n        return $result\r\n    }\r\n    _cleanItemContainer() {\r\n        super._cleanItemContainer();\r\n        var $allDayContainer = this.option(\"allDayContainer\");\r\n        if ($allDayContainer) {\r\n            $allDayContainer.empty()\r\n        }\r\n        this._virtualAppointments = {}\r\n    }\r\n    _clean() {\r\n        super._clean();\r\n        delete this._$currentAppointment;\r\n        delete this._initialSize;\r\n        delete this._initialCoordinates\r\n    }\r\n    _init() {\r\n        super._init();\r\n        this.$element().addClass(COMPONENT_CLASS);\r\n        this._preventSingleAppointmentClick = false\r\n    }\r\n    _renderAppointmentTemplate($container, appointment, model) {\r\n        var config = {\r\n            isAllDay: appointment.allDay,\r\n            isRecurrence: appointment.recurrenceRule,\r\n            html: isPlainObject(appointment) && appointment.html ? appointment.html : void 0\r\n        };\r\n        var formatText = this.invoke(\"getTextAndFormatDate\", model.appointmentData, this._currentAppointmentSettings.agendaSettings || model.targetedAppointmentData, \"TIME\");\r\n        $container.append(this.isAgendaView ? createAgendaAppointmentLayout(formatText, config) : createAppointmentLayout(formatText, config))\r\n    }\r\n    _executeItemRenderAction(index, itemData, itemElement) {\r\n        var action = this._getItemRenderAction();\r\n        if (action) {\r\n            action(this.invoke(\"mapAppointmentFields\", {\r\n                itemData: itemData,\r\n                itemElement: itemElement\r\n            }))\r\n        }\r\n        delete this._currentAppointmentSettings\r\n    }\r\n    _itemClickHandler(e) {\r\n        super._itemClickHandler(e, {}, {\r\n            afterExecute: function(e) {\r\n                this._processItemClick(e.args[0].event)\r\n            }.bind(this)\r\n        })\r\n    }\r\n    _processItemClick(e) {\r\n        var $target = $(e.currentTarget);\r\n        var data = this._getItemData($target);\r\n        if (\"keydown\" === e.type || isFakeClickEvent(e)) {\r\n            this.notifyObserver(\"showEditAppointmentPopup\", {\r\n                data: data,\r\n                target: $target\r\n            });\r\n            return\r\n        }\r\n        this._appointmentClickTimeout = setTimeout(function() {\r\n            if (!this._preventSingleAppointmentClick && domAdapter.getBody().contains($target[0])) {\r\n                this.notifyObserver(\"showAppointmentTooltip\", {\r\n                    data: data,\r\n                    target: $target\r\n                })\r\n            }\r\n            this._preventSingleAppointmentClick = false\r\n        }.bind(this), 300)\r\n    }\r\n    _extendActionArgs($itemElement) {\r\n        var args = super._extendActionArgs($itemElement);\r\n        return this.invoke(\"mapAppointmentFields\", args)\r\n    }\r\n    _render() {\r\n        super._render();\r\n        this._attachAppointmentDblClick()\r\n    }\r\n    _attachAppointmentDblClick() {\r\n        var that = this;\r\n        var itemSelector = that._itemSelector();\r\n        var itemContainer = this._itemContainer();\r\n        eventsEngine.off(itemContainer, DBLCLICK_EVENT_NAME, itemSelector);\r\n        eventsEngine.on(itemContainer, DBLCLICK_EVENT_NAME, itemSelector, (function(e) {\r\n            that._itemDXEventHandler(e, \"onAppointmentDblClick\", {}, {\r\n                afterExecute: function(e) {\r\n                    that._dblClickHandler(e.args[0].event)\r\n                }\r\n            })\r\n        }))\r\n    }\r\n    _dblClickHandler(e) {\r\n        var $targetAppointment = $(e.currentTarget);\r\n        var appointmentData = this._getItemData($targetAppointment);\r\n        clearTimeout(this._appointmentClickTimeout);\r\n        this._preventSingleAppointmentClick = true;\r\n        this.notifyObserver(\"showEditAppointmentPopup\", {\r\n            data: appointmentData,\r\n            target: $targetAppointment\r\n        })\r\n    }\r\n    _renderItem(index, item, container) {\r\n        var itemData = item.itemData;\r\n        var $items = [];\r\n        for (var i = 0; i < item.settings.length; i++) {\r\n            var setting = item.settings[i];\r\n            this._currentAppointmentSettings = setting;\r\n            var $item = super._renderItem(index, itemData, container);\r\n            $item.data(APPOINTMENT_SETTINGS_KEY, setting);\r\n            $items.push($item)\r\n        }\r\n        return $items\r\n    }\r\n    _getItemContent($itemFrame) {\r\n        $itemFrame.data(APPOINTMENT_SETTINGS_KEY, this._currentAppointmentSettings);\r\n        var $itemContent = super._getItemContent($itemFrame);\r\n        return $itemContent\r\n    }\r\n    _createItemByTemplate(itemTemplate, renderArgs) {\r\n        var {\r\n            itemData: itemData,\r\n            container: container,\r\n            index: index\r\n        } = renderArgs;\r\n        return itemTemplate.render({\r\n            model: {\r\n                appointmentData: itemData,\r\n                targetedAppointmentData: this.invoke(\"getTargetedAppointmentData\", itemData, $(container).parent())\r\n            },\r\n            container: container,\r\n            index: index\r\n        })\r\n    }\r\n    _getAppointmentContainer(allDay) {\r\n        var $allDayContainer = this.option(\"allDayContainer\");\r\n        var $container = this.itemsContainer().not($allDayContainer);\r\n        if (allDay && $allDayContainer) {\r\n            $container = $allDayContainer\r\n        }\r\n        return $container\r\n    }\r\n    _postprocessRenderItem(args) {\r\n        this._renderAppointment(args.itemElement, this._currentAppointmentSettings)\r\n    }\r\n    _renderAppointment(element, settings) {\r\n        element.data(APPOINTMENT_SETTINGS_KEY, settings);\r\n        this._applyResourceDataAttr(element);\r\n        var rawAppointment = this._getItemData(element);\r\n        var geometry = this.invoke(\"getAppointmentGeometry\", settings);\r\n        var allowResize = this.option(\"allowResize\") && (!isDefined(settings.skipResizing) || isString(settings.skipResizing));\r\n        var allowDrag = this.option(\"allowDrag\");\r\n        var allDay = settings.allDay;\r\n        this.invoke(\"setCellDataCacheAlias\", this._currentAppointmentSettings, geometry);\r\n        if (settings.virtual) {\r\n            var deferredColor = this.invoke(\"getAppointmentColor\", {\r\n                itemData: rawAppointment,\r\n                groupIndex: settings.groupIndex\r\n            });\r\n            this._processVirtualAppointment(settings, element, rawAppointment, deferredColor)\r\n        } else {\r\n            var _settings$info;\r\n            var config = {\r\n                data: rawAppointment,\r\n                groupIndex: settings.groupIndex,\r\n                observer: this.option(\"observer\"),\r\n                geometry: geometry,\r\n                direction: settings.direction || \"vertical\",\r\n                allowResize: allowResize,\r\n                allowDrag: allowDrag,\r\n                allDay: allDay,\r\n                reduced: settings.appointmentReduced,\r\n                isCompact: settings.isCompact,\r\n                startDate: new Date(null === (_settings$info = settings.info) || void 0 === _settings$info ? void 0 : _settings$info.appointment.startDate),\r\n                cellWidth: this.invoke(\"getCellWidth\"),\r\n                cellHeight: this.invoke(\"getCellHeight\"),\r\n                resizableConfig: this._resizableConfig(rawAppointment, settings)\r\n            };\r\n            if (this.isAgendaView) {\r\n                config.createPlainResourceListAsync = rawAppointment => this.resourceManager._createPlainResourcesByAppointmentAsync(rawAppointment)\r\n            }\r\n            this._createComponent(element, this.isAgendaView ? AgendaAppointment : Appointment, config)\r\n        }\r\n    }\r\n    _applyResourceDataAttr($appointment) {\r\n        var resources = this.invoke(\"getResourcesFromItem\", this._getItemData($appointment));\r\n        if (resources) {\r\n            each(resources, (function(name, values) {\r\n                var attr = \"data-\" + normalizeKey(name.toLowerCase()) + \"-\";\r\n                for (var i = 0; i < values.length; i++) {\r\n                    $appointment.attr(attr + normalizeKey(values[i]), true)\r\n                }\r\n            }))\r\n        }\r\n    }\r\n    _resizableConfig(appointmentData, itemSetting) {\r\n        return {\r\n            area: this._calculateResizableArea(itemSetting, appointmentData),\r\n            onResizeStart: function(e) {\r\n                this._$currentAppointment = $(e.element);\r\n                if (this.invoke(\"needRecalculateResizableArea\")) {\r\n                    var updatedArea = this._calculateResizableArea(this._$currentAppointment.data(APPOINTMENT_SETTINGS_KEY), this._$currentAppointment.data(\"dxItemData\"));\r\n                    e.component.option(\"area\", updatedArea);\r\n                    e.component._renderDragOffsets(e.event)\r\n                }\r\n                this._initialSize = {\r\n                    width: e.width,\r\n                    height: e.height\r\n                };\r\n                this._initialCoordinates = locate(this._$currentAppointment)\r\n            }.bind(this),\r\n            onResizeEnd: function(e) {\r\n                if (this._escPressed) {\r\n                    e.event.cancel = true;\r\n                    return\r\n                }\r\n                this._resizeEndHandler(e)\r\n            }.bind(this)\r\n        }\r\n    }\r\n    _calculateResizableArea(itemSetting, appointmentData) {\r\n        var area = this.$element().closest(\".dx-scrollable-content\");\r\n        return this.invoke(\"getResizableAppointmentArea\", {\r\n            coordinates: {\r\n                left: itemSetting.left,\r\n                top: 0,\r\n                groupIndex: itemSetting.groupIndex\r\n            },\r\n            allDay: itemSetting.allDay\r\n        }) || area\r\n    }\r\n    _resizeEndHandler(e) {\r\n        var scheduler = this.option(\"observer\");\r\n        var $element = $(e.element);\r\n        var {\r\n            info: info\r\n        } = $element.data(\"dxAppointmentSettings\");\r\n        var sourceAppointment = this._getItemData($element);\r\n        var modifiedAppointmentAdapter = scheduler.createAppointmentAdapter(sourceAppointment).clone();\r\n        var startDate = this._getEndResizeAppointmentStartDate(e, sourceAppointment, info.appointment);\r\n        var endDate = info.appointment.endDate;\r\n        var dateRange = this._getDateRange(e, startDate, endDate);\r\n        modifiedAppointmentAdapter.startDate = new Date(dateRange[0]);\r\n        modifiedAppointmentAdapter.endDate = new Date(dateRange[1]);\r\n        this.notifyObserver(\"updateAppointmentAfterResize\", {\r\n            target: sourceAppointment,\r\n            data: modifiedAppointmentAdapter.clone({\r\n                pathTimeZone: \"fromGrid\"\r\n            }).source(),\r\n            $appointment: $element\r\n        })\r\n    }\r\n    _getEndResizeAppointmentStartDate(e, rawAppointment, appointmentInfo) {\r\n        var scheduler = this.option(\"observer\");\r\n        var appointmentAdapter = scheduler.createAppointmentAdapter(rawAppointment);\r\n        var startDate = appointmentInfo.startDate;\r\n        var recurrenceProcessor = getRecurrenceProcessor();\r\n        var {\r\n            recurrenceRule: recurrenceRule,\r\n            startDateTimeZone: startDateTimeZone\r\n        } = appointmentAdapter;\r\n        var isAllDay = this.invoke(\"isAllDay\", rawAppointment);\r\n        var isRecurrent = recurrenceProcessor.isValidRecurrenceRule(recurrenceRule);\r\n        if (!e.handles.top && !isRecurrent && !isAllDay) {\r\n            startDate = scheduler.timeZoneCalculator.createDate(appointmentAdapter.startDate, {\r\n                appointmentTimeZone: startDateTimeZone,\r\n                path: \"toGrid\"\r\n            })\r\n        }\r\n        return startDate\r\n    }\r\n    _getDateRange(e, startDate, endDate) {\r\n        var itemData = this._getItemData(e.element);\r\n        var deltaTime = this.invoke(\"getDeltaTime\", e, this._initialSize, itemData);\r\n        var renderingStrategyDirection = this.invoke(\"getRenderingStrategyDirection\");\r\n        var isStartDateChanged = false;\r\n        var isAllDay = this.invoke(\"isAllDay\", itemData);\r\n        var needCorrectDates = this.invoke(\"needCorrectAppointmentDates\") && !isAllDay;\r\n        var startTime;\r\n        var endTime;\r\n        if (\"vertical\" !== renderingStrategyDirection || isAllDay) {\r\n            isStartDateChanged = this.option(\"rtlEnabled\") ? e.handles.right : e.handles.left\r\n        } else {\r\n            isStartDateChanged = e.handles.top\r\n        }\r\n        if (isStartDateChanged) {\r\n            startTime = needCorrectDates ? this._correctStartDateByDelta(startDate, deltaTime) : startDate.getTime() - deltaTime;\r\n            startTime += timeZoneUtils.getTimezoneOffsetChangeInMs(startDate, endDate, startTime, endDate);\r\n            endTime = endDate.getTime()\r\n        } else {\r\n            startTime = startDate.getTime();\r\n            endTime = needCorrectDates ? this._correctEndDateByDelta(endDate, deltaTime) : endDate.getTime() + deltaTime;\r\n            endTime -= timeZoneUtils.getTimezoneOffsetChangeInMs(startDate, endDate, startDate, endTime)\r\n        }\r\n        return [startTime, endTime]\r\n    }\r\n    _correctEndDateByDelta(endDate, deltaTime) {\r\n        var endDayHour = this.invoke(\"getEndDayHour\");\r\n        var startDayHour = this.invoke(\"getStartDayHour\");\r\n        var result = endDate.getTime() + deltaTime;\r\n        var visibleDayDuration = (endDayHour - startDayHour) * toMs(\"hour\");\r\n        var daysCount = deltaTime > 0 ? Math.ceil(deltaTime / visibleDayDuration) : Math.floor(deltaTime / visibleDayDuration);\r\n        var maxDate = new Date(endDate);\r\n        var minDate = new Date(endDate);\r\n        minDate.setHours(startDayHour, 0, 0, 0);\r\n        maxDate.setHours(endDayHour, 0, 0, 0);\r\n        if (result > maxDate.getTime() || result <= minDate.getTime()) {\r\n            var tailOfCurrentDay = maxDate.getTime() - endDate.getTime();\r\n            var tailOfPrevDays = deltaTime - tailOfCurrentDay;\r\n            var lastDay = new Date(endDate.setDate(endDate.getDate() + daysCount));\r\n            lastDay.setHours(startDayHour, 0, 0, 0);\r\n            result = lastDay.getTime() + tailOfPrevDays - visibleDayDuration * (daysCount - 1)\r\n        }\r\n        return result\r\n    }\r\n    _correctStartDateByDelta(startDate, deltaTime) {\r\n        var endDayHour = this.invoke(\"getEndDayHour\");\r\n        var startDayHour = this.invoke(\"getStartDayHour\");\r\n        var result = startDate.getTime() - deltaTime;\r\n        var visibleDayDuration = (endDayHour - startDayHour) * toMs(\"hour\");\r\n        var daysCount = deltaTime > 0 ? Math.ceil(deltaTime / visibleDayDuration) : Math.floor(deltaTime / visibleDayDuration);\r\n        var maxDate = new Date(startDate);\r\n        var minDate = new Date(startDate);\r\n        minDate.setHours(startDayHour, 0, 0, 0);\r\n        maxDate.setHours(endDayHour, 0, 0, 0);\r\n        if (result < minDate.getTime() || result >= maxDate.getTime()) {\r\n            var tailOfCurrentDay = startDate.getTime() - minDate.getTime();\r\n            var tailOfPrevDays = deltaTime - tailOfCurrentDay;\r\n            var firstDay = new Date(startDate.setDate(startDate.getDate() - daysCount));\r\n            firstDay.setHours(endDayHour, 0, 0, 0);\r\n            result = firstDay.getTime() - tailOfPrevDays + visibleDayDuration * (daysCount - 1)\r\n        }\r\n        return result\r\n    }\r\n    _processVirtualAppointment(appointmentSetting, $appointment, appointmentData, color) {\r\n        var virtualAppointment = appointmentSetting.virtual;\r\n        var virtualGroupIndex = virtualAppointment.index;\r\n        if (!isDefined(this._virtualAppointments[virtualGroupIndex])) {\r\n            this._virtualAppointments[virtualGroupIndex] = {\r\n                coordinates: {\r\n                    top: virtualAppointment.top,\r\n                    left: virtualAppointment.left\r\n                },\r\n                items: {\r\n                    data: [],\r\n                    colors: [],\r\n                    settings: []\r\n                },\r\n                isAllDay: virtualAppointment.isAllDay ? true : false,\r\n                buttonColor: color\r\n            }\r\n        }\r\n        appointmentSetting.targetedAppointmentData = this.invoke(\"getTargetedAppointmentData\", appointmentData, $appointment);\r\n        this._virtualAppointments[virtualGroupIndex].items.settings.push(appointmentSetting);\r\n        this._virtualAppointments[virtualGroupIndex].items.data.push(appointmentData);\r\n        this._virtualAppointments[virtualGroupIndex].items.colors.push(color);\r\n        $appointment.remove()\r\n    }\r\n    _renderContentImpl() {\r\n        super._renderContentImpl();\r\n        this._renderDropDownAppointments()\r\n    }\r\n    _renderDropDownAppointments() {\r\n        this._renderByFragments(($commonFragment, $allDayFragment) => {\r\n            each(this._virtualAppointments, function(groupIndex) {\r\n                var virtualGroup = this._virtualAppointments[groupIndex];\r\n                var virtualItems = virtualGroup.items;\r\n                var virtualCoordinates = virtualGroup.coordinates;\r\n                var $fragment = virtualGroup.isAllDay ? $allDayFragment : $commonFragment;\r\n                var left = virtualCoordinates.left;\r\n                var buttonWidth = this.invoke(\"getDropDownAppointmentWidth\", virtualGroup.isAllDay);\r\n                var buttonHeight = this.invoke(\"getDropDownAppointmentHeight\");\r\n                var rtlOffset = this.option(\"rtlEnabled\") ? buttonWidth : 0;\r\n                this.notifyObserver(\"renderCompactAppointments\", {\r\n                    $container: $fragment,\r\n                    coordinates: {\r\n                        top: virtualCoordinates.top,\r\n                        left: left + rtlOffset\r\n                    },\r\n                    items: virtualItems,\r\n                    buttonColor: virtualGroup.buttonColor,\r\n                    width: buttonWidth - this.option(\"_collectorOffset\"),\r\n                    height: buttonHeight,\r\n                    onAppointmentClick: this.option(\"onItemClick\"),\r\n                    allowDrag: this.option(\"allowDrag\"),\r\n                    cellWidth: this.invoke(\"getCellWidth\"),\r\n                    isCompact: this.invoke(\"isAdaptive\") || this._isGroupCompact(virtualGroup),\r\n                    applyOffset: !virtualGroup.isAllDay && this.invoke(\"isApplyCompactAppointmentOffset\")\r\n                })\r\n            }.bind(this))\r\n        })\r\n    }\r\n    _isGroupCompact(virtualGroup) {\r\n        return !virtualGroup.isAllDay && this.invoke(\"supportCompactDropDownAppointments\")\r\n    }\r\n    _sortAppointmentsByStartDate(appointments) {\r\n        appointments.sort(function(a, b) {\r\n            var result = 0;\r\n            var firstDate = new Date(this.invoke(\"getField\", \"startDate\", a.settings || a)).getTime();\r\n            var secondDate = new Date(this.invoke(\"getField\", \"startDate\", b.settings || b)).getTime();\r\n            if (firstDate < secondDate) {\r\n                result = -1\r\n            }\r\n            if (firstDate > secondDate) {\r\n                result = 1\r\n            }\r\n            return result\r\n        }.bind(this))\r\n    }\r\n    _processRecurrenceAppointment(appointment, index, skipLongAppointments) {\r\n        var recurrenceRule = this.invoke(\"getField\", \"recurrenceRule\", appointment);\r\n        var result = {\r\n            parts: [],\r\n            indexes: []\r\n        };\r\n        if (recurrenceRule) {\r\n            var dates = appointment.settings || appointment;\r\n            var startDate = new Date(this.invoke(\"getField\", \"startDate\", dates));\r\n            var endDate = new Date(this.invoke(\"getField\", \"endDate\", dates));\r\n            var appointmentDuration = endDate.getTime() - startDate.getTime();\r\n            var recurrenceException = this.invoke(\"getField\", \"recurrenceException\", appointment);\r\n            var startViewDate = this.invoke(\"getStartViewDate\");\r\n            var endViewDate = this.invoke(\"getEndViewDate\");\r\n            var recurrentDates = getRecurrenceProcessor().generateDates({\r\n                rule: recurrenceRule,\r\n                exception: recurrenceException,\r\n                start: startDate,\r\n                end: endDate,\r\n                min: startViewDate,\r\n                max: endViewDate\r\n            });\r\n            var recurrentDateCount = appointment.settings ? 1 : recurrentDates.length;\r\n            for (var i = 0; i < recurrentDateCount; i++) {\r\n                var appointmentPart = extend({}, appointment, true);\r\n                if (recurrentDates[i]) {\r\n                    var appointmentSettings = this._applyStartDateToObj(recurrentDates[i], {});\r\n                    this._applyEndDateToObj(new Date(recurrentDates[i].getTime() + appointmentDuration), appointmentSettings);\r\n                    appointmentPart.settings = appointmentSettings\r\n                } else {\r\n                    appointmentPart.settings = dates\r\n                }\r\n                result.parts.push(appointmentPart);\r\n                if (!skipLongAppointments) {\r\n                    this._processLongAppointment(appointmentPart, result)\r\n                }\r\n            }\r\n            result.indexes.push(index)\r\n        }\r\n        return result\r\n    }\r\n    _processLongAppointment(appointment, result) {\r\n        var parts = this.splitAppointmentByDay(appointment);\r\n        var partCount = parts.length;\r\n        var endViewDate = this.invoke(\"getEndViewDate\").getTime();\r\n        var startViewDate = this.invoke(\"getStartViewDate\").getTime();\r\n        var timeZoneCalculator = this.invoke(\"getTimeZoneCalculator\");\r\n        result = result || {\r\n            parts: []\r\n        };\r\n        if (partCount > 1) {\r\n            extend(appointment, parts[0]);\r\n            for (var i = 1; i < partCount; i++) {\r\n                var startDate = this.invoke(\"getField\", \"startDate\", parts[i].settings).getTime();\r\n                startDate = timeZoneCalculator.createDate(startDate, {\r\n                    path: \"toGrid\"\r\n                });\r\n                if (startDate < endViewDate && startDate > startViewDate) {\r\n                    result.parts.push(parts[i])\r\n                }\r\n            }\r\n        }\r\n        return result\r\n    }\r\n    _reduceRecurrenceAppointments(recurrenceIndexes, appointments) {\r\n        each(recurrenceIndexes, (function(i, index) {\r\n            appointments.splice(index - i, 1)\r\n        }))\r\n    }\r\n    _combineAppointments(appointments, additionalAppointments) {\r\n        if (additionalAppointments.length) {\r\n            merge(appointments, additionalAppointments)\r\n        }\r\n        this._sortAppointmentsByStartDate(appointments)\r\n    }\r\n    _applyStartDateToObj(startDate, obj) {\r\n        this.invoke(\"setField\", \"startDate\", obj, startDate);\r\n        return obj\r\n    }\r\n    _applyEndDateToObj(endDate, obj) {\r\n        this.invoke(\"setField\", \"endDate\", obj, endDate);\r\n        return obj\r\n    }\r\n    moveAppointmentBack(dragEvent) {\r\n        var $appointment = this._$currentAppointment;\r\n        var size = this._initialSize;\r\n        var coords = this._initialCoordinates;\r\n        if (dragEvent) {\r\n            this._removeDragSourceClassFromDraggedAppointment();\r\n            if (isDeferred(dragEvent.cancel)) {\r\n                dragEvent.cancel.resolve(true)\r\n            } else {\r\n                dragEvent.cancel = true\r\n            }\r\n        }\r\n        if ($appointment && !dragEvent) {\r\n            if (coords) {\r\n                move($appointment, coords);\r\n                delete this._initialSize\r\n            }\r\n            if (size) {\r\n                $appointment.outerWidth(size.width);\r\n                $appointment.outerHeight(size.height);\r\n                delete this._initialCoordinates\r\n            }\r\n        }\r\n    }\r\n    focus() {\r\n        if (this._$currentAppointment) {\r\n            var focusedElement = getPublicElement(this._$currentAppointment);\r\n            this.option(\"focusedElement\", focusedElement);\r\n            eventsEngine.trigger(focusedElement, \"focus\")\r\n        }\r\n    }\r\n    splitAppointmentByDay(appointment) {\r\n        var dates = appointment.settings || appointment;\r\n        var originalStartDate = new Date(this.invoke(\"getField\", \"startDate\", dates));\r\n        var startDate = dateUtils.makeDate(originalStartDate);\r\n        var endDate = dateUtils.makeDate(this.invoke(\"getField\", \"endDate\", dates));\r\n        var maxAllowedDate = this.invoke(\"getEndViewDate\");\r\n        var startDayHour = this.invoke(\"getStartDayHour\");\r\n        var endDayHour = this.invoke(\"getEndDayHour\");\r\n        var appointmentIsLong = this.invoke(\"appointmentTakesSeveralDays\", appointment);\r\n        var result = [];\r\n        var timeZoneCalculator = this.invoke(\"getTimeZoneCalculator\");\r\n        startDate = timeZoneCalculator.createDate(startDate, {\r\n            path: \"toGrid\"\r\n        });\r\n        endDate = timeZoneCalculator.createDate(endDate, {\r\n            path: \"toGrid\"\r\n        });\r\n        if (startDate.getHours() <= endDayHour && startDate.getHours() >= startDayHour && !appointmentIsLong) {\r\n            result.push(this._applyStartDateToObj(new Date(startDate), {\r\n                appointmentData: appointment\r\n            }));\r\n            startDate.setDate(startDate.getDate() + 1)\r\n        }\r\n        while (appointmentIsLong && startDate.getTime() < endDate.getTime() && startDate < maxAllowedDate) {\r\n            var currentStartDate = new Date(startDate);\r\n            var currentEndDate = new Date(startDate);\r\n            this._checkStartDate(currentStartDate, originalStartDate, startDayHour);\r\n            this._checkEndDate(currentEndDate, endDate, endDayHour);\r\n            var appointmentData = deepExtendArraySafe({}, appointment, true);\r\n            var appointmentSettings = {};\r\n            this._applyStartDateToObj(currentStartDate, appointmentSettings);\r\n            this._applyEndDateToObj(currentEndDate, appointmentSettings);\r\n            appointmentData.settings = appointmentSettings;\r\n            result.push(appointmentData);\r\n            startDate = dateUtils.trimTime(startDate);\r\n            startDate.setDate(startDate.getDate() + 1);\r\n            startDate.setHours(startDayHour)\r\n        }\r\n        return result\r\n    }\r\n    _checkStartDate(currentDate, originalDate, startDayHour) {\r\n        if (!dateUtils.sameDate(currentDate, originalDate) || currentDate.getHours() <= startDayHour) {\r\n            currentDate.setHours(startDayHour, 0, 0, 0)\r\n        } else {\r\n            currentDate.setHours(originalDate.getHours(), originalDate.getMinutes(), originalDate.getSeconds(), originalDate.getMilliseconds())\r\n        }\r\n    }\r\n    _checkEndDate(currentDate, originalDate, endDayHour) {\r\n        if (!dateUtils.sameDate(currentDate, originalDate) || currentDate.getHours() > endDayHour) {\r\n            currentDate.setHours(endDayHour, 0, 0, 0)\r\n        } else {\r\n            currentDate.setHours(originalDate.getHours(), originalDate.getMinutes(), originalDate.getSeconds(), originalDate.getMilliseconds())\r\n        }\r\n    }\r\n    _removeDragSourceClassFromDraggedAppointment() {\r\n        var $appointments = this._itemElements().filter(\".\".concat(APPOINTMENT_DRAG_SOURCE_CLASS));\r\n        $appointments.each((_, element) => {\r\n            var appointmentInstance = $(element).dxSchedulerAppointment(\"instance\");\r\n            appointmentInstance.option(\"isDragSource\", false)\r\n        })\r\n    }\r\n    _setDragSourceAppointment(appointment, settings) {\r\n        var $appointments = this._findItemElementByItem(appointment);\r\n        var {\r\n            startDate: startDate,\r\n            endDate: endDate\r\n        } = settings.info.sourceAppointment;\r\n        var {\r\n            groupIndex: groupIndex\r\n        } = settings;\r\n        $appointments.forEach($item => {\r\n            var {\r\n                info: itemInfo,\r\n                groupIndex: itemGroupIndex\r\n            } = $item.data(APPOINTMENT_SETTINGS_KEY);\r\n            var {\r\n                startDate: itemStartDate,\r\n                endDate: itemEndDate\r\n            } = itemInfo.sourceAppointment;\r\n            var appointmentInstance = $item.dxSchedulerAppointment(\"instance\");\r\n            var isDragSource = startDate.getTime() === itemStartDate.getTime() && endDate.getTime() === itemEndDate.getTime() && groupIndex === itemGroupIndex;\r\n            appointmentInstance.option(\"isDragSource\", isDragSource)\r\n        })\r\n    }\r\n}\r\nregisterComponent(\"dxSchedulerAppointments\", SchedulerAppointments);\r\nexport default SchedulerAppointments;\r\n"]},"metadata":{},"sourceType":"module"}